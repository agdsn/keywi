(function(){var e={773:function(e,t,a){"use strict";var n=a(144),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-app",[a("v-main",[a("app-header"),a("v-container",[a("router-view")],1)],1)],1)},i=[],s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("app-title",{attrs:{"view-title":e.$route.meta.title}}),a("app-nav-bar")],1)},r=[],l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h1",[e._v(" "+e._s(e.viewTitle)+" ")])])},d=[],c=n.Z.extend({name:"AppTitle",props:["viewTitle"]}),u=c,m=a(1001),h=(0,m.Z)(u,l,d,!1,null,"7bc69db0",null),v=h.exports,f=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"nav-bar"},[a("ul",{staticClass:"list left"},[a("li",[a("router-link",{attrs:{to:"/key"}},[a("v-icon",{attrs:{color:"white",left:""}},[e._v("mdi-key-chain")]),e._v(" Schlüssel ")],1)],1),a("li",[a("router-link",{attrs:{to:"/safe"}},[a("v-icon",{attrs:{color:"white",left:""}},[e._v("mdi-safe-square")]),e._v(" Tresore ")],1)],1),a("li",[a("router-link",{attrs:{to:"/lock"}},[a("v-icon",{attrs:{color:"white",left:""}},[e._v("mdi-lock")]),e._v(" Schlösser ")],1)],1),a("li",[a("router-link",{attrs:{to:"/location"}},[a("v-icon",{attrs:{color:"white",left:""}},[e._v("mdi-map-marker")]),e._v(" Orte ")],1)],1),a("li",[a("router-link",{attrs:{to:"/user"}},[a("v-icon",{attrs:{color:"white",left:""}},[e._v("mdi-account-multiple")]),e._v(" Benutzer ")],1)],1),a("li",[a("router-link",{attrs:{to:"/rental"}},[a("v-icon",{attrs:{color:"white",left:""}},[e._v("mdi-hand-coin")]),e._v(" Ausleihen ")],1)],1),a("li",[a("router-link",{attrs:{to:"/log"}},[a("v-icon",{attrs:{color:"white",left:""}},[e._v("mdi-format-list-bulleted-type")]),e._v(" Logs ")],1)],1)]),a("ul",{staticClass:"list"},[e.loggedIn?a("li",[null!=e.user?a("router-link",{staticClass:"mr-8",attrs:{to:"/user/"+e.user.id,href:"#"}},[a("v-icon",{attrs:{color:"white",left:""}},[e._v("mdi-account")]),e._v(" "+e._s(e.user.login)+" ")],1):e._e(),a("a",{on:{click:e.logout}},[a("v-icon",{attrs:{color:"white",left:""}},[e._v("mdi-logout")]),e._v(" Logout ")],1)],1):a("li",[a("a",{on:{click:function(t){return e.$refs.loginDialog.openDialog()}}},[a("v-icon",{attrs:{color:"white",left:""}},[e._v("mdi-login")]),e._v(" Login ")],1)])]),a("form-popup",{ref:"loginDialog",attrs:{"hide-btn":"",form:"login-form",text:"Login"},on:{"save-form":e.checkLogin}})],1)},p=[],k=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-dialog",{attrs:{"max-width":"600px"},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on;return[e.hideBtn?e._e():a("v-btn",e._g({staticClass:"mx-8 my-4",attrs:{title:e.tooltip,disabled:e.disabled,color:"secondary"},on:{click:function(t){return e.$emit("button-add-clicked")}}},n),[e.icon?a("v-icon",{attrs:{left:"",size:"24"}},[e._v(e._s(e.icon))]):e._e(),e._v(" "+e._s(e.text)+" ")],1)]}}]),model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[a("v-card",[a("v-card-title",[a("h2",[e._v(e._s(e.text))])]),a("v-card-text",{staticClass:"pb-10"},[a(e.form,{ref:"form",tag:"component",staticClass:"mx-8 my-4",on:{"save-form":e.saveForm,mounted:e.mountedEvent}})],1)],1)],1)},_=[],b={name:"FormPopup",props:{text:String,hideBtn:{type:Boolean,default:!1},form:String,disabled:{default:!1},tooltip:{default:""},icon:String},data(){return{dialog:!1}},methods:{closeDialog:function(){this.dialog=!1},openDialog(){this.dialog=!0},saveForm:function(){this.$emit("save-form"),this.closeDialog()},mountedEvent(){this.$emit("mounted")},buttonClicked(){console.log("button clicked")}}},g=b,y=a(3453),D=a.n(y),x=a(680),S=a(2371),w=a(7118),$=a(7336),Z=a(6428),E=(0,m.Z)(g,k,_,!1,null,"1a686ca3",null),T=E.exports;D()(E,{VBtn:x.Z,VCard:S.Z,VCardText:w.ZB,VCardTitle:w.EB,VDialog:$.Z,VIcon:Z.Z});var V=a(129),C=a.n(V),I=a(8418),L=a.n(I);let A={};const B=localStorage.getItem("access_token");function z(){const e=new(L())({definition:"https://keywi.agdsn.de/api/openapi.json",withServer:"main",axiosConfigDefaults:{headers:A}}).init();return e}null!=B&&(A={Authorization:`Bearer ${B}`});var R=z(),F=a(9669),U=a.n(F),N={async setAccessToken(e){const t=await R,a=`Bearer ${e}`;U().defaults.headers.common.Authorization=a,t.defaults.headers.Authorization=a;const n=(await t.user_getCurrent()).data;return localStorage.setItem("user",JSON.stringify(n)),localStorage.setItem("access_token",e),window.dispatchEvent(new CustomEvent("keywi-auth-change",{})),!0},async login(e,t){const a=await R,n={username:e,password:t},o=C().stringify(n),i={headers:{"content-type":"application/x-www-form-urlencoded"},data:o},s=(await a.auth_getToken(null,n,i)).data.access_token;return await this.setAccessToken(s),!0},async logout(){const e=await R;localStorage.removeItem("access_token"),localStorage.removeItem("user"),delete U().defaults.headers.common.Authorization,delete e.defaults.headers.Authorization,window.dispatchEvent(new CustomEvent("keywi-auth-change",{}))},getOAuthUrl(e){let t=e,a="https://keywi.agdsn.de/api/auth/start";null==e&&(t=window.location.origin);const n=encodeURIComponent(t);return a=a.concat(`?return_url=${n}`),a},isLoggedIn(){return null!=localStorage.getItem("access_token")},getUser(){const e=localStorage.getItem("user");return null==e?null:JSON.parse(e)}},K=a(8345),O=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"home"},[a("key-table",{ref:"keyTable",staticClass:"mx-7 mt-7",on:{editItem:e.editKey}}),a("v-divider",{staticClass:"mx-8"}),a("form-popup",{ref:"popup",attrs:{text:"Schlüssel hinzufügen",form:"edit-key-form",icon:"mdi-plus"},on:{"save-form":function(t){return e.$refs.keyTable.loadData()},mounted:e.mountedEvent,"button-add-clicked":e.buttonAddClicked}})],1)},P=[],M=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("DataTable",{ref:"table",staticClass:"elevation-1",attrs:{headers:e.headers,"item-class":e.row_classes,items:e.tableData,"multi-sort":"","sort-by":["location.name","lock.name","number"],"loading-text":"Lade Daten..."},scopedSlots:e._u([{key:"header",fn:function(){return[a("h2",{staticClass:"ml-4"},[e._v("Schlüssel")])]},proxy:!0},{key:"item.link",fn:function(t){var n=t.item;return[a("router-link",{attrs:{to:"/key/"+n.id}},[a("v-icon",{attrs:{small:""}},[e._v(" mdi-open-in-new ")])],1)]}},{key:"item.number",fn:function(t){var n=t.item;return[a("router-link",{attrs:{to:"/key/"+n.id}},[e._v(e._s(n.number))])]}},{key:"item.lock.name",fn:function(t){var n=t.item;return[a("router-link",{attrs:{to:"/lock/"+n.lock.id}},[e._v(e._s(n.lock.name))])]}},{key:"item.safe.name",fn:function(t){var n=t.item;return[a("router-link",{attrs:{to:"/safe/"+n.safe.id}},[e._v(e._s(n.safe.name))])]}},{key:"item.location.name",fn:function(t){var n=t.item;return[a("router-link",{attrs:{to:"/location/"+n.location.id}},[e._v(e._s(n.location.name))])]}},{key:"item.rental",fn:function(t){var a=t.item;return[e._v(" "+e._s(e.getRentalStatus(a))+" ")]}},{key:"item.actions",fn:function(t){var n=t.item;return[a("div",{staticClass:"text-right"},[a("v-icon",{staticClass:"mr-2",attrs:{small:""},on:{click:function(t){return e.editItem(n)}}},[e._v(" mdi-pencil ")]),a("v-icon",{attrs:{small:""},on:{click:function(t){return e.openDeletePrompt(n)}}},[e._v(" mdi-delete ")]),e.rentable(n)||e.rentedByUser(n)?a("v-tooltip",{attrs:{top:""},scopedSlots:e._u([{key:"activator",fn:function(t){var o=t.on;return[a("v-icon",e._g({staticClass:"ml-2",attrs:{color:e.getKeyColor(n),small:""},on:{click:function(t){return e.openRentPrompt(n)}}},o),[e._v(" mdi-hand-coin ")])]}}],null,!0)},[a("span",[e._v(e._s(e.getTooltip(n)))])]):e._e()],1)]}}],null,!0)}),a("v-dialog",{attrs:{width:"500px"},model:{value:e.deleteDialog,callback:function(t){e.deleteDialog=t},expression:"deleteDialog"}},[a("v-card",{staticClass:"pb-1"},[a("v-card-title",[e._v("Schlüssel "+e._s(e.keyInDialogNumber)+" wirklich löschen?")]),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"secondary"},on:{click:e.deleteItem}},[a("v-icon",{attrs:{left:"",size:"24"}},[e._v("mdi-delete")]),e._v(" Bestätigen ")],1)],1)],1)],1),a("v-dialog",{attrs:{width:"500px"},model:{value:e.returnDialog,callback:function(t){e.returnDialog=t},expression:"returnDialog"}},[a("v-card",{staticClass:"pb-1"},[a("v-card-title",[e._v("Schlüssel "+e._s(e.keyInDialogNumber)+" wirklich zurückgeben?")]),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"secondary"},on:{click:e.returnItem}},[a("v-icon",{attrs:{left:"",size:"24"}},[e._v("mdi-content-save-outline")]),e._v(" Bestätigen ")],1)],1)],1)],1),a("v-dialog",{ref:"rentForm",attrs:{width:"500px"},model:{value:e.rentDialog,callback:function(t){e.rentDialog=t},expression:"rentDialog"}},[a("v-card",{staticClass:"pb-1"},[a("v-card-title",[e._v("Schlüssel "+e._s(e.keyInDialogNumber)+" wirklich ausleihen?")]),a("v-card-text",[a("v-form",{ref:"form"},[a("v-autocomplete",{attrs:{"item-text":function(e){return e.name},items:e.users,rules:e.userRules,label:"Vergeben an","prepend-icon":"mdi-account","return-object":""},model:{value:e.pickedUser,callback:function(t){e.pickedUser=t},expression:"pickedUser"}}),a("v-text-field",{attrs:{label:"Dokument","prepend-icon":"mdi-file-document"},model:{value:e.grantingDocument,callback:function(t){e.grantingDocument=t},expression:"grantingDocument"}}),a("v-textarea",{attrs:{label:"Notiz","prepend-icon":"mdi-note-text-outline",rows:"1"},model:{value:e.note,callback:function(t){e.note=t},expression:"note"}}),a("v-checkbox",{attrs:{label:"Startdatum bearbeiten"},model:{value:e.editStartDate,callback:function(t){e.editStartDate=t},expression:"editStartDate"}}),a("v-menu",{attrs:{"close-on-content-click":!1,"nudge-right":40,transition:"scale-transition","offset-y":"","min-width":"auto"},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on,o=t.attrs;return[a("v-text-field",e._g(e._b({staticStyle:{"margin-top":"-10px"},attrs:{disabled:!e.editStartDate,label:"Startdatum","prepend-icon":"mdi-calendar",readonly:""},model:{value:e.dateStart,callback:function(t){e.dateStart=t},expression:"dateStart"}},"v-text-field",o,!1),n))]}}]),model:{value:e.menuStartDate,callback:function(t){e.menuStartDate=t},expression:"menuStartDate"}},[a("v-date-picker",{on:{input:function(t){e.menuStartDate=!1}},model:{value:e.dateStart,callback:function(t){e.dateStart=t},expression:"dateStart"}})],1),a("v-checkbox",{attrs:{label:"Enddatum bearbeiten"},model:{value:e.editEndDate,callback:function(t){e.editEndDate=t},expression:"editEndDate"}}),a("v-menu",{attrs:{"close-on-content-click":!1,"nudge-right":40,transition:"scale-transition","offset-y":"","min-width":"auto"},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on,o=t.attrs;return[a("v-text-field",e._g(e._b({staticStyle:{"margin-top":"-10px"},attrs:{disabled:!e.editEndDate,label:"Enddatum","prepend-icon":"mdi-calendar",readonly:""},model:{value:e.dateEnd,callback:function(t){e.dateEnd=t},expression:"dateEnd"}},"v-text-field",o,!1),n))]}}]),model:{value:e.menuEndDate,callback:function(t){e.menuEndDate=t},expression:"menuEndDate"}},[a("v-date-picker",{on:{input:function(t){e.menuEndDate=!1}},model:{value:e.dateEnd,callback:function(t){e.dateEnd=t},expression:"dateEnd"}})],1)],1)],1),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"secondary"},on:{click:e.rentKey}},[a("v-icon",{attrs:{left:"",size:"24"}},[e._v("mdi-content-save-outline")]),e._v(" Speichern ")],1)],1)],1)],1)],1)},j=[],q=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-data-table",e._g(e._b({staticClass:"elevation-1",attrs:{items:e.realItems,search:e.externalSearch?null:e.searchModel,loading:e.loading,"loading-text":"Lade Daten...","items-per-page":15,"item-key":e.itemKey,"footer-props":e.footerProps},scopedSlots:e._u([{key:"top",fn:function(){return[a("v-row",[a("v-col",{attrs:{"align-self":"start"}},[e._t("header")],2),e.$slots.header||e.$scopedSlots.header?e._e():a("v-spacer"),e.showSearch||e.externalSearch?a("v-col",{attrs:{lg:"3",md:"6",sm:"12","align-self":"center"}},[a("v-text-field",{staticClass:"mr-4 ml-4",attrs:{label:"Search","hide-details":"",outlined:"",dense:""},on:{input:function(t){return e.$emit("search",e.searchModel)}},scopedSlots:e._u([{key:"prepend-inner",fn:function(){return[a("v-icon",[e._v(" mdi-magnify ")])]},proxy:!0}],null,!1,2092382991),model:{value:e.searchModel,callback:function(t){e.searchModel=t},expression:"searchModel"}})],1):e._e()],1)]},proxy:!0},{key:"footer.page-text",fn:function(){return[a("v-row",[a("v-col",{attrs:{"align-self":"center"}},[e._t("footer-right")],2)],1)]},proxy:!0},e._l(e.inheritSlots,(function(t,a){return{key:a,fn:function(t){return[e._t(a,null,null,t)]}}}))],null,!0)},"v-data-table",e.$attrs,!1),e.$listeners))},G=[],J={name:"DataTable",data(){return{searchModel:null}},props:{externalSearch:{type:Boolean,default:!1},items:Array,showSearch:{type:Boolean,default:!0},itemKey:{type:String,default:"id"},footerProps:{type:Object,default(){return{"items-per-page-options":[5,10,15,25,50]}}}},computed:{loading(){return null==this.items},inheritSlots(){const e=this.$scopedSlots;return"header"in e&&delete e.header,e},realItems(){return this.items?this.items:[]}},watch:{searchModel(){this.$emit("update:search",this.searchModel)}}},W=J,H=a(2102),Y=a(9808),Q=a(2877),X=a(9762),ee=a(5978),te=(0,m.Z)(W,q,G,!1,null,null,null),ae=te.exports;D()(te,{VCol:H.Z,VDataTable:Y.Z,VIcon:Z.Z,VRow:Q.Z,VSpacer:X.Z,VTextField:ee.Z});var ne={name:"KeyTable",components:{DataTable:ae},data:()=>({keyInDialog:void 0,deleteDialog:!1,rentDialog:!1,returnDialog:!1,grantingDocument:"",note:"",menuStartDate:!1,editStartDate:!1,dateStart:void 0,menuEndDate:!1,editEndDate:!1,dateEnd:void 0,headers:[{width:"5%",text:"Link",value:"link"},{text:"Ort",value:"location.name"},{text:"Schloss",value:"lock.name"},{text:"Schlüsselnummer",value:"number"},{text:"Tresor",value:"safe.name"},{text:"Ausleihe",value:"rental"},{text:"Aktionen",value:"actions",width:"200px",sortable:!1,align:"right"}],tableData:null,usersLoaded:!1,users:[],pickedUser:void 0,userRules:[e=>!!e||"Bitte Nutzer auswählen"],keyId:void 0}),mounted(){this.loadData()},methods:{async loadData(){let e=this.$route.params.id;const t=await R;e?t.key_getKey(e).then((e=>{this.tableData=[e.data]})):t.key_getKeys().then((e=>{this.tableData=e.data}))},editItem(e){this.$emit("editItem",e)},openDeletePrompt(e){this.keyInDialog=e,this.deleteDialog=!0},openRentPrompt(e){this.keyInDialog=e,this.editStartDate=!1,this.editEndDate=!1,this.rentedByUser(e)?this.returnDialog=!0:(this.loadUsers(),this.rentDialog=!0,this.grantingDocument="",this.note="",this.dateStart="",this.dateEnd="",this.pickedUser=void 0)},async loadUsers(){if(this.usersLoaded)return;this.usersLoaded=!0;const e=await R;e.user_getUsers().then((e=>{this.users=e.data}))},async deleteItem(){const e=await R,t={uuid:this.keyInDialog.id};e.key_deleteKey(t).then((()=>{this.deleteDialog=!1,this.loadData()}))},async returnItem(){const e=await R,t={uuid:this.keyInDialog.active_rental.id};e.rental_endRental(t).then((()=>{this.returnDialog=!1,this.loadData()}))},dateToDatetime(e){return e+"T12:37"},async rentKey(){if(this.$refs.form.validate()){const e=await R,t={key_id:this.keyInDialog.id,user_id:this.pickedUser.id,allowed_by:this.grantingDocument,note:this.note};this.editStartDate&&this.dateStart&&(t.begin=this.dateToDatetime(this.dateStart)),this.editEndDate&&this.dateEnd&&(t.end=this.dateToDatetime(this.dateEnd)),e.rental_createRental(null,t).then((()=>{this.rentDialog=!1,this.$refs.form.resetValidation(),this.pickedUser=void 0,this.loadData()}))}},getRentalStatus(e){return this.rentedByUser(e)?"Ausgeliehen (von dir)":e.active_rental?"Ausgeliehen":e.rentable?"Ausleihbar":"Nicht ausleihbar"},rentable(e){return"Ausleihbar"==this.getRentalStatus(e)},row_classes(e){return null==e.active_rental&&e.rentable?"green-cell":e.rentable?"red-cell":"grey-cell"},getKeyColor(e){return"initial"},getTooltip(e){return this.rentedByUser(e)?"Schlüssel zurückgeben":"Schlüssel ausleihen"},rentedByUser(e){if(!e.active_rental)return!1;let t=N.getUser();return t.id==e.active_rental.user_id}},computed:{keyInDialogNumber(){return this.keyInDialog?this.keyInDialog.number:""}}},oe=ne,ie=a(1835),se=a(9362),re=a(9094),le=a(6232),de=a(1152),ce=a(4350),ue=a(9330),me=(0,m.Z)(oe,M,j,!1,null,"225a1c08",null),he=me.exports;D()(me,{VAutocomplete:ie.Z,VBtn:x.Z,VCard:S.Z,VCardActions:w.h7,VCardText:w.ZB,VCardTitle:w.EB,VCheckbox:se.Z,VDatePicker:re.Z,VDialog:$.Z,VForm:le.Z,VIcon:Z.Z,VMenu:de.Z,VSpacer:X.Z,VTextField:ee.Z,VTextarea:ce.Z,VTooltip:ue.Z});var ve=n.Z.extend({name:"AllKeysView",components:{KeyTable:he,FormPopup:T},data(){return{editedKey:void 0}},methods:{editKey(e){this.editedKey=e,this.$refs.popup.openDialog(),this.$refs.popup.$refs.form&&this.$refs.popup.$refs.form.fillForm(this.editedKey)},mountedEvent(){this.$refs.popup.$refs.form.fillForm(this.editedKey)},buttonAddClicked(){this.editedKey=void 0,this.$refs.popup.$refs.form&&this.$refs.popup.$refs.form.fillForm(this.editedKey)}}}),fe=ve,pe=a(1418),ke=(0,m.Z)(fe,O,P,!1,null,"62115910",null),_e=ke.exports;D()(ke,{VDivider:pe.Z});var be=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"home"},[a("safe-table",{ref:"safeTable",staticClass:"mx-7 mt-7",on:{editItem:e.editSafe}}),a("v-divider",{staticClass:"mx-8"}),a("form-popup",{ref:"popup",attrs:{text:"Tresor hinzufügen",form:"edit-safe-form",icon:"mdi-plus"},on:{"save-form":function(t){return e.$refs.safeTable.loadData()},mounted:e.mountedEvent,"button-add-clicked":e.buttonAddClicked}})],1)},ge=[],ye=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("DataTable",{ref:"table",attrs:{headers:e.headers,items:e.tableData,"sort-by":"name"},scopedSlots:e._u([{key:"header",fn:function(){return[a("h2",{staticClass:"ml-4"},[e._v("Tresore")])]},proxy:!0},{key:"item.location.name",fn:function(t){var n=t.item;return[a("router-link",{attrs:{to:"/location/"+n.location.id}},[e._v(e._s(n.location.name))])]}},{key:"item.name",fn:function(t){var n=t.item;return[a("router-link",{attrs:{to:"/safe/"+n.id}},[e._v(e._s(n.name))])]}},{key:"item.actions",fn:function(t){var n=t.item;return[a("div",{staticClass:"text-right"},[a("v-icon",{staticClass:"mr-2",attrs:{small:""},on:{click:function(t){return e.editItem(n)}}},[e._v(" mdi-pencil ")]),a("v-icon",{attrs:{small:""},on:{click:function(t){return e.openDeletePrompt(n)}}},[e._v(" mdi-delete ")])],1)]}}],null,!0)}),a("v-dialog",{attrs:{width:"500px"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[a("v-card",{staticClass:"pb-1"},[a("v-card-title",[e._v("Tresor "+e._s(e.safeToDeleteName)+" wirklich löschen?")]),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"secondary"},on:{click:e.deleteItem}},[a("v-icon",{attrs:{left:"",size:"24"}},[e._v("mdi-delete")]),e._v(" Bestätigen ")],1)],1)],1)],1)],1)},De=[],xe={name:"SafeTable",components:{DataTable:ae},data:()=>({dialog:!1,safeToDelete:void 0,headers:[{text:"Tresor",value:"name"},{text:"Ort",value:"location.name"},{text:"Anzahl Schlüssel",value:"amount_keys"},{text:"Aktionen",value:"actions",width:"200px",sortable:!1,align:"right"}],tableData:null}),mounted(){this.loadData()},computed:{safeToDeleteName(){return this.safeToDelete?this.safeToDelete.name:""}},methods:{async loadData(){let e=this.$route.params.id;const t=await R;e?t.safe_getSafe(e).then((e=>{this.tableData=[e.data]})):t.safe_getSafes().then((e=>{this.tableData=e.data}))},editItem(e){this.$emit("editItem",e)},openDeletePrompt(e){this.safeToDelete=e,this.dialog=!0},async deleteItem(){const e=await R,t={uuid:this.safeToDelete.id};e.safe_deleteSafe(t).then((()=>{this.dialog=!1,this.loadData()}))}}},Se=xe,we=(0,m.Z)(Se,ye,De,!1,null,null,null),$e=we.exports;D()(we,{VBtn:x.Z,VCard:S.Z,VCardActions:w.h7,VCardTitle:w.EB,VDialog:$.Z,VIcon:Z.Z,VSpacer:X.Z});var Ze=n.Z.extend({name:"AllSafesView",components:{SafeTable:$e,FormPopup:T},data(){return{editedSafe:void 0}},methods:{editSafe(e){this.editedSafe=e,this.$refs.popup.openDialog(),this.$refs.popup.$refs.form&&this.$refs.popup.$refs.form.fillForm(this.editedSafe)},mountedEvent(){this.$refs.popup.$refs.form.fillForm(this.editedSafe)},buttonAddClicked(){this.editedSafe=void 0,this.$refs.popup.$refs.form&&this.$refs.popup.$refs.form.fillForm(this.editedSafe)}}}),Ee=Ze,Te=(0,m.Z)(Ee,be,ge,!1,null,"5300266c",null),Ve=Te.exports;D()(Te,{VDivider:pe.Z});var Ce=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"home"},[a("lock-table",{ref:"lockTable",staticClass:"mx-7 mt-7",on:{editItem:e.editLock}}),a("v-divider",{staticClass:"mx-8"}),a("form-popup",{ref:"popup",attrs:{form:"edit-lock-form",icon:"mdi-plus",text:"Schloss hinzufügen"},on:{mounted:e.mountedEvent,"save-form":function(t){return e.$refs.lockTable.loadData()},"button-add-clicked":e.buttonAddClicked}})],1)},Ie=[],Le=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("DataTable",{ref:"table",staticClass:"elevation-1",attrs:{headers:e.headers,items:e.tableData,"multi-sort":"","sort-by":["location.name","name"],"loading-text":"Lade Daten..."},scopedSlots:e._u([{key:"header",fn:function(){return[a("h2",{staticClass:"ml-4"},[e._v("Schlösser")])]},proxy:!0},{key:"item.link",fn:function(t){var n=t.item;return[a("router-link",{attrs:{to:"/lock/"+n.id}},[a("v-icon",{attrs:{small:""}},[e._v(" mdi-open-in-new ")])],1)]}},{key:"item.location.name",fn:function(t){var n=t.item;return[a("router-link",{attrs:{to:"/location/"+n.location.id}},[e._v(e._s(n.location.name))])]}},{key:"item.name",fn:function(t){var n=t.item;return[a("router-link",{attrs:{to:"/lock/"+n.id}},[e._v(e._s(n.name))])]}},{key:"item.available_keys",fn:function(t){var a=t.item;return[e._v(" "+e._s(a.amount_free_keys)+" / "+e._s(a.amount_keys)+" ")]}},{key:"item.actions",fn:function(t){var n=t.item;return[a("div",{staticClass:"text-right"},[a("v-icon",{staticClass:"mr-2",attrs:{small:""},on:{click:function(t){return e.editItem(n)}}},[e._v(" mdi-pencil ")]),a("v-icon",{attrs:{small:""},on:{click:function(t){return e.openDeletePrompt(n)}}},[e._v(" mdi-delete ")])],1)]}}],null,!0)}),a("v-dialog",{attrs:{width:"500px"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[a("v-card",{staticClass:"pb-1"},[a("v-card-title",[e._v("Schloss "+e._s(e.lockToDeleteName)+" wirklich löschen?")]),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"secondary"},on:{click:e.deleteItem}},[a("v-icon",{attrs:{left:"",size:"24"}},[e._v("mdi-delete")]),e._v(" Bestätigen ")],1)],1)],1)],1)],1)},Ae=[],Be={name:"LockTable",components:{DataTable:ae},data:()=>({dialog:!1,lockToDelete:void 0,headers:[{width:"5%",text:"Link",value:"link"},{text:"Ort",value:"location.name"},{text:"Schloss",value:"name"},{text:"Besitzer",value:"owner"},{text:"Verfügbare Schlüssel",value:"available_keys"},{text:"Aktionen",value:"actions",width:"200px",sortable:!1,align:"right"}],tableData:null}),computed:{lockToDeleteName(){return this.lockToDelete?this.lockToDelete.name:""}},mounted(){this.loadData()},methods:{async loadData(){let e=this.$route.params.id;const t=await R;e?t.lock_getLock(e).then((e=>{this.tableData=[e.data]})):t.lock_getLocks().then((e=>{this.tableData=e.data}))},editItem(e){this.$emit("editItem",e)},openDeletePrompt(e){this.lockToDelete=e,this.dialog=!0},async deleteItem(){const e=await R,t={uuid:this.lockToDelete.id};e.lock_deleteLock(t).then((()=>{this.dialog=!1,this.loadData()}))}}},ze=Be,Re=(0,m.Z)(ze,Le,Ae,!1,null,null,null),Fe=Re.exports;D()(Re,{VBtn:x.Z,VCard:S.Z,VCardActions:w.h7,VCardTitle:w.EB,VDialog:$.Z,VIcon:Z.Z,VSpacer:X.Z});var Ue=n.Z.extend({name:"AllLocksView",components:{LockTable:Fe,FormPopup:T},data(){return{editedLock:void 0}},methods:{editLock(e){this.editedLock=e,this.$refs.popup.openDialog(),this.$refs.popup.$refs.form&&this.$refs.popup.$refs.form.fillForm(this.editedLock)},mountedEvent(){this.$refs.popup.$refs.form.fillForm(this.editedLock)},buttonAddClicked(){this.editedLock=void 0,this.$refs.popup.$refs.form&&this.$refs.popup.$refs.form.fillForm(this.editedLock)}}}),Ne=Ue,Ke=(0,m.Z)(Ne,Ce,Ie,!1,null,"4994f2ba",null),Oe=Ke.exports;D()(Ke,{VDivider:pe.Z});var Pe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"home pb-5"},[a("location-table",{ref:"locationTable",staticClass:"mx-7 mt-7",on:{editItem:e.editLocation}}),a("form-popup",{ref:"popup",attrs:{text:"Ort hinzufügen",form:"edit-location-form",icon:"mdi-plus"},on:{"save-form":function(t){return e.$refs.locationTable.loadData()},mounted:e.mountedEvent,"button-add-clicked":e.buttonAddClicked}})],1)},Me=[],je=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("DataTable",{ref:"table",staticClass:"elevation-1",attrs:{headers:e.headers,items:e.tableData,"sort-by":"name"},scopedSlots:e._u([{key:"header",fn:function(){return[a("h2",{staticClass:"ml-4"},[e._v("Orte")])]},proxy:!0},{key:"item.name",fn:function(t){var n=t.item;return[a("router-link",{attrs:{to:"/location/"+n.id}},[e._v(e._s(n.name))])]}},{key:"item.actions",fn:function(t){var n=t.item;return[a("div",{staticClass:"text-right"},[a("v-icon",{staticClass:"mr-2",attrs:{small:""},on:{click:function(t){return e.editItem(n)}}},[e._v(" mdi-pencil ")]),a("v-icon",{attrs:{small:""},on:{click:function(t){return e.openDeletePrompt(n)}}},[e._v(" mdi-delete ")])],1)]}}],null,!0)}),a("v-dialog",{attrs:{width:"500px"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[a("v-card",{staticClass:"pb-1"},[a("v-card-title",[e._v("Ort "+e._s(e.locationToDeleteName)+" wirklich löschen?")]),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"secondary"},on:{click:e.deleteItem}},[a("v-icon",{attrs:{left:"",size:"24"}},[e._v("mdi-delete")]),e._v(" Bestätigen ")],1)],1)],1)],1)],1)},qe=[],Ge={name:"LocationTable",components:{DataTable:ae},data:()=>({dialog:!1,locationToDelete:void 0,headers:[{text:"Ort",value:"name"},{text:"Adresse",value:"address"},{text:"Anzahl Tresore",value:"amount_safes"},{text:"Anzahl Schlösser",value:"amount_locks"},{text:"Aktionen",value:"actions",width:"200px",sortable:!1,align:"right"}],tableData:null}),mounted(){this.loadData()},computed:{locationToDeleteName(){return this.locationToDelete?this.locationToDelete.name:""}},methods:{async loadData(){let e=this.$route.params.id;const t=await R;e?t.location_getLocation(e).then((e=>{this.tableData=[e.data]})):t.location_getLocations().then((e=>{this.tableData=e.data}))},editItem(e){this.$emit("editItem",e)},openDeletePrompt(e){this.locationToDelete=e,this.dialog=!0},async deleteItem(){const e=await R,t={uuid:this.locationToDelete.id};e.location_deleteLocation(t).then((()=>{this.dialog=!1,this.loadData()}))}}},Je=Ge,We=(0,m.Z)(Je,je,qe,!1,null,null,null),He=We.exports;D()(We,{VBtn:x.Z,VCard:S.Z,VCardActions:w.h7,VCardTitle:w.EB,VDialog:$.Z,VIcon:Z.Z,VSpacer:X.Z});var Ye=n.Z.extend({name:"AllLocationsView",components:{FormPopup:T,LocationTable:He},data(){return{editedLocation:void 0}},methods:{editLocation(e){this.editedLocation=e,this.$refs.popup.openDialog(),this.$refs.popup.$refs.form&&this.$refs.popup.$refs.form.fillForm(this.editedLocation)},mountedEvent(){this.$refs.popup.$refs.form.fillForm(this.editedLocation)},buttonAddClicked(){this.editedLocation=void 0,this.$refs.popup.$refs.form&&this.$refs.popup.$refs.form.fillForm(this.editedLocation)}}}),Qe=Ye,Xe=(0,m.Z)(Qe,Pe,Me,!1,null,"b6037bf8",null),et=Xe.exports,tt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"home"},[a("user-table",{staticClass:"mx-7 mt-7"})],1)},at=[],nt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("DataTable",{ref:"table",attrs:{headers:e.headers,items:e.tableData,"sort-by":"name"},scopedSlots:e._u([{key:"header",fn:function(){return[a("h2",{staticClass:"ml-4"},[e._v("Benutzer")])]},proxy:!0},{key:"item.name",fn:function(t){var n=t.item;return[a("router-link",{attrs:{to:"/user/"+n.id}},[e._v(e._s(n.name))])]}}],null,!0)})],1)},ot=[],it={name:"UserTable",components:{DataTable:ae},data:()=>({headers:[{text:"Name",value:"name"},{text:"Nutzername",value:"login"},{text:"Mail-Adresse",value:"email"},{text:"Rolle",value:"role"}],tableData:null}),mounted(){this.loadData()},methods:{async loadData(){let e=this.$route.params.id;const t=await R;e?t.user_getUser(e).then((e=>{this.tableData=[e.data]})):t.user_getUsers().then((e=>{this.tableData=e.data}))}}},st=it,rt=(0,m.Z)(st,nt,ot,!1,null,"baa3f3fa",null),lt=rt.exports,dt=n.Z.extend({name:"AllUsersView",components:{UserTable:lt}}),ct=dt,ut=(0,m.Z)(ct,tt,at,!1,null,"4b45231e",null),mt=ut.exports,ht=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",{staticClass:"home pb-5 pt-1"},[a("div",{staticClass:"mx-8"},[a("h2",{staticClass:"my-2"},[e._v("Nutzer Daten")]),a("v-simple-table",{scopedSlots:e._u([{key:"default",fn:function(){return[a("tbody",[a("tr",[a("td",{staticStyle:{width:"20%"}},[e._v("Name")]),a("td",[a("b",[e._v(e._s(e.user.name))])])]),a("tr",[a("td",[e._v("Loginname")]),a("td",[e._v(" "+e._s(e.user.login)+" ")])]),a("tr",[a("td",[e._v("Mail-Adresse")]),a("td",[e._v(" "+e._s(e.user.email)+" ")])]),a("tr",[a("td",[e._v("Rolle")]),a("td",[e._v(" "+e._s(e.user.role)+" ")])]),a("tr",[a("td",[e._v("Notiz")]),a("td",[e._v(e._s(e.user.note))])])])]},proxy:!0}])}),a("v-divider"),a("div",{staticClass:"buttons"},[a("v-btn",{staticClass:"mx-8 my-4",attrs:{color:"secondary"},on:{click:e.downloadProtocol}},[a("v-icon",{attrs:{left:"",size:"24"}},[e._v("mdi-file-download")]),e._v(" Protokoll ")],1)],1),a("detail-table-rentals",{ref:"rentalTable",staticClass:"mt-10"}),a("detail-table-logs",{ref:"logTable",staticClass:"mt-10"})],1)])},vt=[],ft=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("DataTable",{ref:"table",attrs:{headers:e.headers,items:e.tableData,"sort-by":"begin","sort-desc":!0},scopedSlots:e._u([{key:"header",fn:function(){return[a("h2",{staticClass:"ml-4"},[e._v("Ausleihen")])]},proxy:!0},{key:"item.begin",fn:function(t){var a=t.item;return[e._v(" "+e._s(new Date(a.begin).toLocaleString("de"))+" ")]}},{key:"item.end",fn:function(t){var n=t.item;return[null!=n.end?a("span",[e._v(" "+e._s(new Date(n.end).toLocaleString("de"))+" ")]):a("span",[e._v(" - ")])]}},{key:"item.key.lock.location",fn:function(t){var n=t.item;return[a("router-link",{attrs:{to:"/location/"+n.key.lock.location.id}},[e._v(e._s(n.key.lock.location.name))])]}},{key:"item.key.lock",fn:function(t){var n=t.item;return[a("router-link",{attrs:{to:"/lock/"+n.key.lock.id}},[e._v(e._s(n.key.lock.name))])]}},{key:"item.key",fn:function(t){var n=t.item;return[a("router-link",{attrs:{to:"/key/"+n.key.id}},[e._v(e._s(n.key.number))])]}},{key:"item.user.name",fn:function(t){var n=t.item;return[a("router-link",{attrs:{to:"/user/"+n.user.id}},[e._v(e._s(n.user.name))])]}},{key:"item.actions",fn:function(t){var n=t.item;return[a("router-link",{attrs:{to:"/rental/"+n.id}},[a("v-icon",{staticClass:"mr-2",attrs:{small:""}},[e._v(" mdi-open-in-new ")])],1)]}}],null,!0)})},pt=[],kt={name:"DetailTableKeys",components:{DataTable:ae},data:()=>({headers:[{text:"Links",value:"actions",width:"5%",sortable:!1},{text:"Ort",value:"key.lock.location"},{text:"Schloss",value:"key.lock"},{text:"Schlüsselnummer",value:"key"},{text:"Ausgeliehen von",value:"user.name"},{text:"Beginn",value:"begin"},{text:"Ende",value:"end"}],tableData:null}),methods:{async loadDataByKeyId(e){this.removeColumn("key.lock.name"),this.removeColumn("key.number"),this.removeColumn("key.safe.name");const t=await R;let a={key_id:e};t.rental_getRentals(a).then((e=>{this.tableData=e.data}))},async loadDataByUserId(e){this.removeColumn("user.name");const t=await R;let a={user_id:e};t.rental_getRentals(a).then((e=>{this.tableData=e.data}))},removeColumn(e){let t=this.headers.find((t=>t.value==e)),a=this.headers.indexOf(t);a>-1&&this.headers.splice(a,1)}},computed:{}},_t=kt,bt=(0,m.Z)(_t,ft,pt,!1,null,"0235b12d",null),gt=bt.exports;D()(bt,{VIcon:Z.Z});var yt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("DataTable",{ref:"table",attrs:{headers:e.headers,items:e.tableData,"sort-by":"timestamp","sort-desc":!0},scopedSlots:e._u([{key:"header",fn:function(){return[a("h2",{staticClass:"ml-4"},[e._v("Logs")])]},proxy:!0},{key:"item.timestamp",fn:function(t){var a=t.item;return[e._v(" "+e._s(new Date(a.timestamp).toLocaleString())+" ")]}},{key:"item.creator.name",fn:function(t){var n=t.item;return[a("router-link",{attrs:{to:"/user/"+n.creator.id}},[e._v(e._s(n.creator.name))])]}},{key:"item.actions",fn:function(t){var n=t.item;return[a("div",{staticClass:"text-right"},e._l(["location","key","user","lock","safe","rental"],(function(t){return a("span",{key:t,staticStyle:{cursor:"pointer"}},[null!=n[t]?a("router-link",{staticClass:"mr-2 mt-1",staticStyle:{cursor:"pointer"},attrs:{to:"/"+t+"/"+n[t].id}},[a("v-chip",{staticStyle:{cursor:"pointer"},attrs:{color:"secondary",outlined:""}},[a("v-icon",{staticClass:"mr-1",attrs:{small:""}},[e._v(" "+e._s(e.obj_icons[t])+" ")]),n[t].name?a("span",[e._v(e._s(n[t].name))]):n[t].number?a("span",[e._v(e._s(n[t].number))]):n[t].begin?a("span",[e._v(e._s(new Date(n[t].begin).getDate().toLocaleString()))]):e._e()],1)],1):e._e()],1)})),0)]}}],null,!0)})],1)},Dt=[],xt={name:"DetailTableLogs",components:{DataTable:ae},data:()=>({headers:[{text:"Datum",value:"timestamp",width:"10%"},{text:"Nutzer",value:"creator.name"},{text:"Nachricht",value:"message"},{text:"Links",value:"actions",width:"20%",sortable:!1,align:"right"}],tableData:null,obj_icons:{location:"mdi-map-marker",key:"mdi-key",user:"mdi-account",lock:"mdi-lock",safe:"mdi-safe-square",rental:"mdi-hand-coin"}}),methods:{async loadData(e){const t=await R;t.log_getLogs(e).then((e=>{this.tableData=e.data}))}},computed:{}},St=xt,wt=a(5424),$t=(0,m.Z)(St,yt,Dt,!1,null,null,null),Zt=$t.exports;D()($t,{VChip:wt.Z,VIcon:Z.Z});var Et={name:"DetailUserView",components:{DetailTableLogs:Zt,DetailTableRentals:gt},data(){return{user:{name:"",login:"",email:"",note:""},userId:void 0}},mounted(){this.userId=this.$route.params.id,this.loadUser(),this.loadRentals(),this.loadLogs()},methods:{loadLogs(){this.$refs.logTable.loadData({user_id:this.userId})},async loadUser(){if(!this.userId)return;const e=await R;e.user_getUser(this.userId).then((e=>{this.user=e.data}))},async loadRentals(){this.$refs.rentalTable.loadDataByUserId(this.userId)},showFile(e,t,a="application/pdf"){const n=new Blob([e],{type:a}),o=window.URL.createObjectURL(n),i=document.createElement("a");i.href=o,i.download=t,i.click(),setTimeout((()=>{window.URL.revokeObjectURL(o)}),100)},async downloadProtocol(){const e=await R;e.user_getUserProtocol({uuid:this.user.id},null,{responseType:"blob"}).then((e=>{const t=new Date,a=t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0");this.showFile(e.data,`${this.user.login}-${a}.pdf`)}))}}},Tt=Et,Vt=a(3568),Ct=(0,m.Z)(Tt,ht,vt,!1,null,"bd980c52",null),It=Ct.exports;D()(Ct,{VBtn:x.Z,VCard:S.Z,VDivider:pe.Z,VIcon:Z.Z,VSimpleTable:Vt.Z});var Lt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",{staticClass:"home pb-5 pt-1"},[a("div",{staticClass:"home pb-5"},[a("div",{staticClass:"mx-8"},[e.location.deleted?a("v-alert",{attrs:{color:"error"}},[e._v("Gelöscht.")]):e._e(),a("h2",{staticClass:"my-2"},[e._v("Ort Daten")]),a("v-simple-table",{scopedSlots:e._u([{key:"default",fn:function(){return[a("tbody",[a("tr",[a("td",{staticStyle:{width:"20%"}},[a("span",[e._v("Name")])]),a("td",[a("b",[e._v(e._s(e.location.name))])])]),a("tr",[a("td",[e._v(" Adresse ")]),a("td",[e._v(e._s(e.location.address))])]),a("tr",[a("td",[e._v(" Anzahl Schlösser ")]),a("td",[e._v(e._s(e.location.amount_locks))])]),a("tr",[a("td",[e._v(" Anzahl Tresore ")]),a("td",[e._v(e._s(e.location.amount_safes))])]),a("tr",[a("td",[e._v(" Notiz ")]),a("td",[e._v(e._s(e.location.note))])])])]},proxy:!0}])}),a("v-divider"),a("div",{staticClass:"buttons"},[a("form-popup",{ref:"popup",attrs:{form:"edit-location-form",icon:"mdi-pencil",text:"Bearbeiten"},on:{mounted:e.mountedEvent,"save-form":function(t){e.loadLocation(),e.loadLogs()},"button-add-clicked":e.mountedEvent}}),a("v-dialog",{attrs:{width:"500px"},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on;return[a("div",{staticClass:"tooltip",attrs:{title:e.tooltip}},[a("v-btn",e._g({staticClass:"mx-8 my-4",attrs:{disabled:e.deleteDisabled,color:"secondary"}},n),[a("v-icon",{attrs:{left:"",size:"24"}},[e._v("mdi-delete")]),e._v(" Löschen ")],1)],1)]}}]),model:{value:e.deleteDialog,callback:function(t){e.deleteDialog=t},expression:"deleteDialog"}},[a("v-card",{staticClass:"pb-1"},[a("v-card-title",[e._v("Ort "+e._s(e.location.name)+" wirklich löschen?")]),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"secondary"},on:{click:e.deleteItem}},[a("v-icon",{attrs:{left:"",size:"24"}},[e._v("mdi-delete")]),e._v(" Bestätigen ")],1)],1)],1)],1)],1),a("detail-table-locks",{ref:"lockTable",staticClass:"mt-10",on:{empty:function(t){e.locksEmpty=!0}}}),a("detail-table-safes",{ref:"safeTable",staticClass:"mt-10",on:{empty:function(t){e.safesEmpty=!0}}}),a("detail-table-logs",{ref:"logTable",staticClass:"mt-10"})],1)])])},At=[],Bt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("DataTable",{ref:"table",attrs:{headers:e.headers,items:e.tableData,"sort-by":"name"},scopedSlots:e._u([{key:"header",fn:function(){return[a("h2",{staticClass:"ml-4"},[e._v("Schlösser")])]},proxy:!0},{key:"item.available_keys",fn:function(t){var a=t.item;return[e._v(" "+e._s(a.amount_free_keys)+" / "+e._s(a.amount_keys)+" ")]}},{key:"item.name",fn:function(t){var n=t.item;return[a("router-link",{attrs:{to:"/lock/"+n.id}},[e._v(e._s(n.name))])]}}],null,!0)})},zt=[],Rt={name:"DetailTableLocks",components:{DataTable:ae},data:()=>({headers:[{text:"Schloss",value:"name"},{text:"Besitzer",value:"owner"},{text:"Verfügbare Schlüssel",value:"available_keys"}],tableData:null}),methods:{async loadDataByLocationId(e){const t=await R;let a={location_id:e};t.lock_getLocks(a).then((e=>{this.tableData=e.data})).finally((()=>{0==this.tableData.length&&this.$emit("empty")}))}}},Ft=Rt,Ut=(0,m.Z)(Ft,Bt,zt,!1,null,null,null),Nt=Ut.exports,Kt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("DataTable",{ref:"table",attrs:{headers:e.headers,items:e.tableData,"sort-by":"name"},scopedSlots:e._u([{key:"header",fn:function(){return[a("h2",{staticClass:"ml-4"},[e._v("Tresore")])]},proxy:!0},{key:"item.name",fn:function(t){var n=t.item;return[a("router-link",{attrs:{to:"/safe/"+n.id}},[e._v(e._s(n.name))])]}}],null,!0)})},Ot=[],Pt={name:"DetailTableSafes",components:{DataTable:ae},data:()=>({headers:[{text:"Tresor",value:"name"},{text:"Anzahl Schlüssel",value:"amount_keys"}],tableData:null}),methods:{async loadDataByLocationId(e){const t=await R;let a={location_id:e};t.safe_getSafes(a).then((e=>{this.tableData=e.data})).finally((()=>{0==this.tableData.length&&this.$emit("empty")}))}}},Mt=Pt,jt=(0,m.Z)(Mt,Kt,Ot,!1,null,null,null),qt=jt.exports,Gt={name:"LocationView",components:{DetailTableLogs:Zt,DetailTableLocks:Nt,DetailTableSafes:qt,FormPopup:T},data(){return{location:{},locationId:void 0,deleteDialog:!1,locksEmpty:!1,safesEmpty:!1}},mounted(){this.locationId=this.$route.params.id,this.loadLocation(),this.loadLocks(),this.loadSafes(),this.loadLogs()},methods:{loadLogs(){this.$refs.logTable.loadData({location_id:this.locationId})},async loadLocation(){if(!this.locationId)return;const e=await R;e.location_getLocation(this.locationId).then((e=>{this.location=e.data}))},async loadLocks(){this.$refs.lockTable.loadDataByLocationId(this.locationId)},async loadSafes(){this.$refs.safeTable.loadDataByLocationId(this.locationId)},mountedEvent(){this.$refs.popup.$refs.form&&this.$refs.popup.$refs.form.fillForm(this.location)},async deleteItem(){const e=await R,t={uuid:this.location.id};e.location_deleteLocation(t).then((()=>{this.$router.push("/location")}))}},computed:{deleteDisabled(){return!this.safesEmpty},tooltip(){return this.deleteDisabled?"Ort kann nur gelöscht werden, wenn ihm keine Tresore zugewiesen sind":""}}},Jt=Gt,Wt=a(1234),Ht=(0,m.Z)(Jt,Lt,At,!1,null,"c401078a",null),Yt=Ht.exports;D()(Ht,{VAlert:Wt.Z,VBtn:x.Z,VCard:S.Z,VCardActions:w.h7,VCardTitle:w.EB,VDialog:$.Z,VDivider:pe.Z,VIcon:Z.Z,VSimpleTable:Vt.Z,VSpacer:X.Z});var Qt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",{staticClass:"home pb-5 pt-1"},[a("div",{staticClass:"home pb-5"},[a("div",{staticClass:"mx-8"},[e.safe.deleted?a("v-alert",{attrs:{color:"error"}},[e._v("Gelöscht.")]):e._e(),a("h2",{staticClass:"my-2"},[e._v("Tresor Daten")]),a("v-simple-table",{scopedSlots:e._u([{key:"default",fn:function(){return[a("tbody",[a("tr",[a("td",{staticStyle:{width:"20%"}},[e._v("Name")]),a("td",[a("b",[e._v(e._s(e.safe.name))])])]),a("tr",[a("td",[e._v("Ort")]),a("td",[a("router-link",{attrs:{to:"/location/"+e.safe.location.id}},[e._v(e._s(e.safe.location.name))])],1)]),a("tr",[a("td",[e._v("Anzahl Schlüssel")]),a("td",[e._v(e._s(e.safe.amount_keys))])]),a("tr",[a("td",[e._v("Notiz")]),a("td",[e._v(e._s(e.safe.note))])])])]},proxy:!0}])}),a("v-divider"),a("div",{staticClass:"buttons"},[a("form-popup",{ref:"popup_add",attrs:{form:"edit-key-form",icon:"mdi-plus",text:"Schlüssel hinzufügen"},on:{mounted:e.addMountedEvent,"save-form":function(t){return e.keyAdded()},"button-add-clicked":e.addMountedEvent}}),a("form-popup",{ref:"popup",attrs:{form:"edit-safe-form",icon:"mdi-pencil",text:"Bearbeiten"},on:{mounted:e.mountedEvent,"save-form":function(t){e.loadSafe(),e.loadLogs()},"button-add-clicked":e.mountedEvent}}),a("v-dialog",{attrs:{width:"500px"},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on;return[a("div",{staticClass:"tooltip",attrs:{title:e.tooltip}},[a("v-btn",e._g({staticClass:"mx-8 my-4",attrs:{disabled:e.deleteDisabled,color:"secondary"}},n),[a("v-icon",{attrs:{left:"",size:"24"}},[e._v("mdi-delete")]),e._v(" Löschen ")],1)],1)]}}]),model:{value:e.deleteDialog,callback:function(t){e.deleteDialog=t},expression:"deleteDialog"}},[a("v-card",{staticClass:"pb-1"},[a("v-card-title",[e._v("Tresor "+e._s(e.safe.name)+" wirklich löschen?")]),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"secondary"},on:{click:e.deleteItem}},[a("v-icon",{attrs:{left:"",size:"24"}},[e._v("mdi-delete")]),e._v(" Bestätigen ")],1)],1)],1)],1)],1),a("detail-table-keys",{ref:"keyTable",staticClass:"mt-10",on:{empty:function(t){e.keysEmpty=!0},rented:function(t){return e.$refs.keyTable.loadDataBySafeId(e.safe.id)}}}),a("detail-table-logs",{ref:"logTable",staticClass:"mt-10"})],1)])])},Xt=[],ea=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("DataTable",{ref:"table",attrs:{headers:e.headers,"item-class":e.row_classes,items:e.tableData,"sort-by":"number"},scopedSlots:e._u([{key:"header",fn:function(){return[a("h2",{staticClass:"ml-4"},[e._v("Schlüssel")])]},proxy:!0},{key:"item.number",fn:function(t){var n=t.item;return[a("router-link",{attrs:{to:"/key/"+n.id}},[e._v(e._s(n.number))])]}},{key:"item.safe.name",fn:function(t){var n=t.item;return[a("router-link",{attrs:{to:"/safe/"+n.safe.id}},[e._v(e._s(n.safe.name))])]}},{key:"item.lock.name",fn:function(t){var n=t.item;return[a("router-link",{attrs:{to:"/lock/"+n.lock.id}},[e._v(e._s(n.lock.name))])]}},{key:"item.rental",fn:function(t){var a=t.item;return[e._v(" "+e._s(e.getRentalStatus(a))+" ")]}},{key:"item.actions",fn:function(t){var n=t.item;return[a("div",{staticClass:"text-right"},[e.rentable(n)||e.rentedByUser(n)?a("v-tooltip",{attrs:{top:""},scopedSlots:e._u([{key:"activator",fn:function(t){var o=t.on;return[a("v-icon",e._g({staticClass:"ml-2",attrs:{color:e.getKeyColor(n),small:""},on:{click:function(t){return e.openRentPrompt(n)}}},o),[e._v(" mdi-hand-coin ")])]}}],null,!0)},[a("span",[e._v(e._s(e.getTooltip(n)))])]):e._e()],1)]}}],null,!0)}),a("v-dialog",{attrs:{width:"500px"},model:{value:e.returnDialog,callback:function(t){e.returnDialog=t},expression:"returnDialog"}},[a("v-card",{staticClass:"pb-1"},[a("v-card-title",[e._v("Schlüssel "+e._s(e.keyInDialogNumber)+" wirklich zurückgeben?")]),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"secondary"},on:{click:e.returnItem}},[a("v-icon",{attrs:{left:"",size:"24"}},[e._v("mdi-content-save-outline")]),e._v(" Bestätigen ")],1)],1)],1)],1),a("v-dialog",{attrs:{width:"500px"},model:{value:e.rentDialog,callback:function(t){e.rentDialog=t},expression:"rentDialog"}},[a("v-card",{staticClass:"pb-1"},[a("v-card-title",[e._v("Schlüssel "+e._s(e.keyInDialogNumber)+" wirklich ausleihen?")]),a("v-card-text",[a("v-form",{ref:"form"},[a("v-autocomplete",{attrs:{"item-text":function(e){return e.name},items:e.users,rules:e.userRules,label:"Vergeben an","prepend-icon":"mdi-account","return-object":""},model:{value:e.pickedUser,callback:function(t){e.pickedUser=t},expression:"pickedUser"}}),a("v-text-field",{attrs:{label:"Dokument","prepend-icon":"mdi-file-document"},model:{value:e.grantingDocument,callback:function(t){e.grantingDocument=t},expression:"grantingDocument"}}),a("v-textarea",{attrs:{label:"Notiz","prepend-icon":"mdi-note-text-outline",rows:"1"},model:{value:e.note,callback:function(t){e.note=t},expression:"note"}}),a("v-checkbox",{attrs:{label:"Startdatum bearbeiten"},model:{value:e.editStartDate,callback:function(t){e.editStartDate=t},expression:"editStartDate"}}),a("v-menu",{attrs:{"close-on-content-click":!1,"nudge-right":40,transition:"scale-transition","offset-y":"","min-width":"auto"},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on,o=t.attrs;return[a("v-text-field",e._g(e._b({staticStyle:{"margin-top":"-10px"},attrs:{disabled:!e.editStartDate,label:"Startdatum","prepend-icon":"mdi-calendar",readonly:""},model:{value:e.dateStart,callback:function(t){e.dateStart=t},expression:"dateStart"}},"v-text-field",o,!1),n))]}}]),model:{value:e.menuStartDate,callback:function(t){e.menuStartDate=t},expression:"menuStartDate"}},[a("v-date-picker",{on:{input:function(t){e.menuStartDate=!1}},model:{value:e.dateStart,callback:function(t){e.dateStart=t},expression:"dateStart"}})],1),a("v-checkbox",{attrs:{label:"Enddatum bearbeiten"},model:{value:e.editEndDate,callback:function(t){e.editEndDate=t},expression:"editEndDate"}}),a("v-menu",{attrs:{"close-on-content-click":!1,"nudge-right":40,transition:"scale-transition","offset-y":"","min-width":"auto"},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on,o=t.attrs;return[a("v-text-field",e._g(e._b({staticStyle:{"margin-top":"-10px"},attrs:{disabled:!e.editEndDate,label:"Enddatum","prepend-icon":"mdi-calendar",readonly:""},model:{value:e.dateEnd,callback:function(t){e.dateEnd=t},expression:"dateEnd"}},"v-text-field",o,!1),n))]}}]),model:{value:e.menuEndDate,callback:function(t){e.menuEndDate=t},expression:"menuEndDate"}},[a("v-date-picker",{on:{input:function(t){e.menuEndDate=!1}},model:{value:e.dateEnd,callback:function(t){e.dateEnd=t},expression:"dateEnd"}})],1)],1)],1),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"secondary"},on:{click:e.rentKey}},[a("v-icon",{attrs:{left:"",size:"24"}},[e._v("mdi-content-save-outline")]),e._v(" Speichern ")],1)],1)],1)],1)],1)},ta=[],aa={name:"DetailTableKeys",components:{DataTable:ae},data:()=>({keyInDialog:void 0,rentDialog:!1,returnDialog:!1,grantingDocument:"",note:"",menuStartDate:!1,editStartDate:!1,dateStart:void 0,menuEndDate:!1,editEndDate:!1,dateEnd:void 0,headers:[{text:"Schlüsselnummer",value:"number"},{text:"Tresor",value:"safe.name"},{text:"Schloss",value:"lock.name"},{text:"Ausleihe",value:"rental"},{text:"Aktionen",value:"actions",width:"200px",sortable:!1,align:"right"}],tableData:null,usersLoaded:!1,users:[],pickedUser:void 0,userRules:[e=>!!e||"Bitte Nutzer auswählen"]}),methods:{async loadDataBySafeId(e){let t=this.headers.find((e=>"safe.name"==e.value)),a=this.headers.indexOf(t);a>-1&&this.headers.splice(a,1);const n=await R;let o={safe_id:e};n.key_getKeys(o).then((e=>{this.tableData=e.data})).finally((()=>{0==this.tableData.length&&this.$emit("empty")}))},async loadDataByLockId(e){let t=this.headers.find((e=>"lock.name"==e.value)),a=this.headers.indexOf(t);a>-1&&this.headers.splice(a,1);const n=await R;let o={lock_id:e};n.key_getKeys(o).then((e=>{this.tableData=e.data})).finally((()=>{0==this.tableData.length&&this.$emit("empty")}))},getRentalStatus(e){return this.rentedByUser(e)?"Ausgeliehen (von dir)":e.active_rental?"Ausgeliehen":e.rentable?"Ausleihbar":"Nicht ausleihbar"},row_classes(e){return null==e.active_rental&&e.rentable?"green-cell":e.rentable?"red-cell":"grey-cell"},getKeyColor(e){return"initial"},openRentPrompt(e){this.keyInDialog=e,this.editStartDate=!1,this.editEndDate=!1,this.rentedByUser(e)?this.returnDialog=!0:(this.loadUsers(),this.rentDialog=!0,this.grantingDocument="",this.note="",this.dateStart="",this.dateEnd="",this.pickedUser=void 0)},getTooltip(e){return this.rentedByUser(e)?"Schlüssel zurückgeben":"Schlüssel ausleihen"},rentedByUser(e){if(!e.active_rental)return!1;let t=N.getUser();return t.id==e.active_rental.user_id},async loadUsers(){if(this.usersLoaded)return;this.usersLoaded=!0;const e=await R;e.user_getUsers().then((e=>{this.users=e.data}))},async returnItem(){const e=await R,t={uuid:this.keyInDialog.active_rental.id};e.rental_endRental(t).then((()=>{this.returnDialog=!1,this.$emit("rented")}))},dateToDatetime(e){return e+"T12:37"},async rentKey(){if(this.$refs.form.validate()){const e=await R,t={key_id:this.keyInDialog.id,user_id:this.pickedUser.id,allowed_by:this.grantingDocument,note:this.note};this.editStartDate&&this.dateStart&&(t.begin=this.dateToDatetime(this.dateStart)),this.editEndDate&&this.dateEnd&&(t.end=this.dateToDatetime(this.dateEnd)),e.rental_createRental(null,t).then((()=>{this.rentDialog=!1,this.$emit("rented"),this.$refs.form.resetValidation(),this.pickedUser=void 0}))}},rentable(e){return"Ausleihbar"===this.getRentalStatus(e)}},computed:{keyInDialogNumber(){return this.keyInDialog?this.keyInDialog.number:""}}},na=aa,oa=(0,m.Z)(na,ea,ta,!1,null,"ddad19ba",null),ia=oa.exports;D()(oa,{VAutocomplete:ie.Z,VBtn:x.Z,VCard:S.Z,VCardActions:w.h7,VCardText:w.ZB,VCardTitle:w.EB,VCheckbox:se.Z,VDatePicker:re.Z,VDialog:$.Z,VForm:le.Z,VIcon:Z.Z,VMenu:de.Z,VSpacer:X.Z,VTextField:ee.Z,VTextarea:ce.Z,VTooltip:ue.Z});var sa={name:"DetailSafeView",components:{DetailTableLogs:Zt,DetailTableKeys:ia,FormPopup:T},data(){return{safe:{location:{}},safeId:void 0,deleteDialog:!1,keysEmpty:!1}},mounted(){this.safeId=this.$route.params.id,this.loadSafe(),this.loadKeys(),this.loadLogs()},methods:{loadLogs(){this.$refs.logTable.loadData({safe_id:this.safeId})},async loadSafe(){if(!this.safeId)return;const e=await R;e.safe_getSafe(this.safeId).then((e=>{this.safe=e.data}))},async loadKeys(){this.$refs.keyTable.loadDataBySafeId(this.safeId)},mountedEvent(){this.$refs.popup.$refs.form&&this.$refs.popup.$refs.form.fillForm(this.safe)},addMountedEvent(){let e={safe:this.safe};this.$refs.popup_add.$refs.form&&this.$refs.popup_add.$refs.form.fillForm(e)},keyAdded(){let e=this.$refs.popup_add.$refs.form.keyId;this.$router.push("/key/"+e)},async deleteItem(){const e=await R,t={uuid:this.safe.id};e.safe_deleteSafe(t).then((()=>{this.$router.push("/safe")}))}},computed:{deleteDisabled(){return!this.keysEmpty},tooltip(){return this.deleteDisabled?"Tresor kann nur gelöscht werden, wenn ihm keine Schlüssel zugewiesen sind":""}}},ra=sa,la=(0,m.Z)(ra,Qt,Xt,!1,null,"1c86f560",null),da=la.exports;D()(la,{VAlert:Wt.Z,VBtn:x.Z,VCard:S.Z,VCardActions:w.h7,VCardTitle:w.EB,VDialog:$.Z,VDivider:pe.Z,VIcon:Z.Z,VSimpleTable:Vt.Z,VSpacer:X.Z});var ca=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",{staticClass:"home pb-5 pt-1"},[a("div",{staticClass:"home pb-5"},[a("div",{staticClass:"mx-8"},[e.lock.deleted?a("v-alert",{attrs:{color:"error"}},[e._v("Gelöscht.")]):e._e(),a("h2",{staticClass:"my-2"},[e._v("Schloss Daten")]),a("v-simple-table",{scopedSlots:e._u([{key:"default",fn:function(){return[a("tbody",[a("tr",[a("td",{staticStyle:{width:"20%"}},[e._v("Name")]),a("td",[a("b",[e._v(e._s(e.lock.name))])])]),a("tr",[a("td",[e._v("Ort")]),a("td",[a("router-link",{attrs:{to:"/location/"+e.lock.location.id}},[e._v(e._s(e.lock.location.name))])],1)]),a("tr",[a("td",[e._v("Besitzer")]),a("td",[e._v(e._s(e.lock.owner))])]),a("tr",[a("td",[e._v("Anzahl Schlüssel")]),a("td",[e._v(e._s(e.lock.amount_keys)+" ("+e._s(e.lock.amount_free_keys)+" verfügbar)")])]),a("tr",[a("td",[e._v("Notiz")]),a("td",[e._v(e._s(e.lock.note))])])])]},proxy:!0}])}),a("v-divider"),a("div",{staticClass:"buttons"},[a("form-popup",{ref:"popup_add",attrs:{form:"edit-key-form",icon:"mdi-plus",text:"Schlüssel hinzufügen"},on:{mounted:e.addMountedEvent,"save-form":function(t){return e.keyAdded()},"button-add-clicked":e.addMountedEvent}}),a("form-popup",{ref:"popup",attrs:{form:"edit-lock-form",icon:"mdi-pencil",text:"Bearbeiten"},on:{mounted:e.mountedEvent,"save-form":function(t){e.loadLock(),e.loadLogs()},"button-add-clicked":e.mountedEvent}}),a("v-dialog",{attrs:{width:"500px"},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on;return[a("v-btn",e._g({staticClass:"mx-8 my-4",attrs:{color:"secondary"}},n),[a("v-icon",{attrs:{left:"",size:"24"}},[e._v("mdi-delete")]),e._v(" Löschen ")],1)]}}]),model:{value:e.deleteDialog,callback:function(t){e.deleteDialog=t},expression:"deleteDialog"}},[a("v-card",{staticClass:"pb-1"},[a("v-card-title",[e._v("Schloss "+e._s(e.lock.name)+" wirklich löschen?")]),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"secondary"},on:{click:e.deleteItem}},[a("v-icon",{attrs:{left:"",size:"24"}},[e._v("mdi-delete")]),e._v(" Bestätigen ")],1)],1)],1)],1)],1),a("detail-table-keys",{ref:"keyTable",staticClass:"mt-10",on:{empty:function(t){e.keysEmpty=!0},rented:function(t){return e.$refs.keyTable.loadDataByLockId(e.lock.id)}}}),a("detail-table-logs",{ref:"logTable",staticClass:"mt-10"})],1)])])},ua=[],ma={name:"DetailLockView",components:{DetailTableLogs:Zt,DetailTableKeys:ia,FormPopup:T},data(){return{lock:{location:{}},lockId:void 0,deleteDialog:!1,keysEmpty:!1}},mounted(){this.lockId=this.$route.params.id,this.loadLock(),this.loadKeys(),this.loadLogs()},methods:{loadLogs(){this.$refs.logTable.loadData({lock_id:this.lockId})},async loadLock(){if(!this.lockId)return;const e=await R;e.lock_getLock(this.lockId).then((e=>{this.lock=e.data}))},async loadKeys(){this.$refs.keyTable.loadDataByLockId(this.lockId)},mountedEvent(){this.$refs.popup.$refs.form&&this.$refs.popup.$refs.form.fillForm(this.lock)},addMountedEvent(){let e={lock:this.lock};this.$refs.popup_add.$refs.form&&this.$refs.popup_add.$refs.form.fillForm(e)},keyAdded(){let e=this.$refs.popup_add.$refs.form.keyId;this.$router.push("/key/"+e)},async deleteItem(){const e=await R,t={uuid:this.lock.id};e.lock_deleteLock(t).then((()=>{this.$router.push("/lock")}))}},computed:{deleteDisabled(){return!this.keysEmpty},tooltip(){return this.deleteDisabled?"Schloss kann nur gelöscht werden, wenn ihm keine Schlüssel zugewiesen sind":""}}},ha=ma,va=(0,m.Z)(ha,ca,ua,!1,null,"59dd2de2",null),fa=va.exports;D()(va,{VAlert:Wt.Z,VBtn:x.Z,VCard:S.Z,VCardActions:w.h7,VCardTitle:w.EB,VDialog:$.Z,VDivider:pe.Z,VIcon:Z.Z,VSimpleTable:Vt.Z,VSpacer:X.Z});var pa=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",{staticClass:"home pb-5 pt-1"},[a("div",{staticClass:"mx-8"},[e.key.deleted?a("v-alert",{attrs:{color:"error"}},[e._v("Gelöscht.")]):e._e(),a("h2",{staticClass:"my-2"},[e._v("Schlüssel Daten")]),a("v-simple-table",{scopedSlots:e._u([{key:"default",fn:function(){return[a("tbody",[a("tr",[a("td",{staticStyle:{width:"20%"}},[e._v("Schlüsselnummer")]),a("td",[a("b",[e._v(e._s(e.key.number))])])]),a("tr",[a("td",[e._v("Schloss")]),a("td",[a("router-link",{attrs:{to:"/lock/"+e.key.lock.id}},[e._v(e._s(e.key.lock.name))])],1)]),a("tr",[a("td",[e._v("Tresor")]),a("td",[a("router-link",{attrs:{to:"/safe/"+e.key.safe.id}},[e._v(e._s(e.key.safe.name))])],1)]),a("tr",[a("td",[e._v("Ausleihe")]),a("td",{class:e.rentalColor},[e._v(e._s(e.rentalStatus))])]),a("tr",[a("td",[e._v("Notiz")]),a("td",[e._v(e._s(e.key.note))])])])]},proxy:!0}])}),a("v-divider"),a("div",{staticClass:"buttons"},[e.rentedByUser?a("v-dialog",{attrs:{width:"500px"},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on;return[a("v-btn",e._g({staticClass:"mx-8 my-4",attrs:{color:"secondary"}},n),[a("v-icon",{attrs:{left:"",size:"24"}},[e._v("mdi-key")]),e._v(" Zurückgeben ")],1)]}}],null,!1,989103630),model:{value:e.returnDialog,callback:function(t){e.returnDialog=t},expression:"returnDialog"}},[a("v-card",{staticClass:"pb-1"},[a("v-card-title",[e._v("Schlüssel "+e._s(e.key.name)+" wirklich zurückgeben?")]),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"secondary"},on:{click:e.returnItem}},[a("v-icon",{attrs:{left:"",size:"24"}},[e._v("mdi-content-save-outline")]),e._v(" Speichern ")],1)],1)],1)],1):e._e(),e.rentalEnabled?a("form-popup",{ref:"rentalPopup",attrs:{form:"rent-key-form",icon:"mdi-key",text:"Ausleihen"},on:{mounted:e.rentalFormMountedEvent,"save-form":function(t){e.loadKey(),e.loadRentals(),e.loadLogs()}}}):e._e(),a("form-popup",{ref:"popup",attrs:{form:"edit-key-form",icon:"mdi-pencil",text:"Bearbeiten"},on:{mounted:e.mountedEvent,"save-form":function(t){e.loadKey(),e.loadLogs()},"button-add-clicked":e.mountedEvent}}),a("v-dialog",{attrs:{width:"500px"},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on;return[a("v-btn",e._g({staticClass:"mx-8 my-4",attrs:{color:"secondary"}},n),[a("v-icon",{attrs:{left:"",size:"24"}},[e._v("mdi-delete")]),e._v(" Löschen ")],1)]}}]),model:{value:e.deleteDialog,callback:function(t){e.deleteDialog=t},expression:"deleteDialog"}},[a("v-card",{staticClass:"pb-1"},[a("v-card-title",[e._v("Schlüssel "+e._s(e.key.name)+" wirklich löschen?")]),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"secondary"},on:{click:e.deleteItem}},[a("v-icon",{attrs:{left:"",size:"24"}},[e._v("mdi-delete")]),e._v(" Bestätigen ")],1)],1)],1)],1)],1),a("detail-table-rentals",{ref:"rentalTable",staticClass:"mt-10"}),a("detail-table-logs",{ref:"logTable",staticClass:"mt-10"})],1)])},ka=[],_a={name:"DetailKeyView",components:{DetailTableLogs:Zt,DetailTableRentals:gt,FormPopup:T},data(){return{key:{location:{},safe:{},lock:{}},keyId:void 0,deleteDialog:!1,rentDialog:!1,returnDialog:!1}},mounted(){this.keyId=this.$route.params.id,this.loadKey(),this.loadRentals(),this.loadLogs()},methods:{loadLogs(){this.$refs.logTable.loadData({key_id:this.keyId})},async loadKey(){if(!this.keyId)return;const e=await R;e.key_getKey(this.keyId).then((e=>{this.key=e.data}))},async loadRentals(){this.$refs.rentalTable.loadDataByKeyId(this.keyId)},rentalFormMountedEvent(){this.$refs.rentalPopup.$refs.form&&this.$refs.rentalPopup.$refs.form.setKeyId(this.key.id)},mountedEvent(){this.$refs.popup.$refs.form&&this.$refs.popup.$refs.form.fillForm(this.key)},async deleteItem(){const e=await R,t={uuid:this.key.id};e.key_deleteKey(t).then((()=>{this.$router.push("/key")}))},async returnItem(){const e=await R,t={uuid:this.key.active_rental.id};e.rental_endRental(t).then((()=>{this.returnDialog=!1,this.loadKey(),this.loadRentals()}))}},computed:{rentalStatus(){return this.key?this.rentedByUser?"Ausgeliehen (von dir)":this.key.active_rental?"Ausgeliehen":this.key.rentable?"Ausleihbar":"Nicht ausleihbar":""},rentalColor(){return null==this.key.active_rental&&this.key.rentable?"green-cell":"red-cell"},deleteDisabled(){return void 0!=this.key.active_rental},rentalEnabled(){return"Ausleihbar"==this.rentalStatus},tooltip(){return this.deleteDisabled?"Schlüssel kann nur gelöscht werden, wenn er momentan nicht verliehen ist":""},rentedByUser(){if(!this.key.active_rental)return!1;let e=N.getUser();return e.id==this.key.active_rental.user_id}}},ba=_a,ga=(0,m.Z)(ba,pa,ka,!1,null,"20a9664b",null),ya=ga.exports;D()(ga,{VAlert:Wt.Z,VBtn:x.Z,VCard:S.Z,VCardActions:w.h7,VCardTitle:w.EB,VDialog:$.Z,VDivider:pe.Z,VIcon:Z.Z,VSimpleTable:Vt.Z,VSpacer:X.Z});var Da=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"text-center"},[e._m(0),a("div",[e.loggedOut?a("span",{staticClass:"subtitle-1"},[e._v(" Bitte melde dich an, um Keywi zu nutzen. ")]):e._e()])])},xa=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h1",[e._v("Willkommen bei Keywi, der digitalen Schlüsselverwaltung.")])])}],Sa={name:"StartView",computed:{loggedOut(){return!N.isLoggedIn()}}},wa=Sa,$a=(0,m.Z)(wa,Da,xa,!1,null,null,null),Za=$a.exports,Ea=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",{staticClass:"home pb-5 pt-1"},[a("div",{staticClass:"mx-8"},[e.rental.deleted?a("v-alert",{attrs:{color:"error"}},[e._v("Gelöscht.")]):e._e(),a("h2",{staticClass:"my-2"},[e._v("Ausleihe Daten")]),a("v-simple-table",{scopedSlots:e._u([{key:"default",fn:function(){return[a("tbody",[a("tr",[a("td",{staticStyle:{width:"20%"}},[e._v("Schlüssel")]),a("td",[a("router-link",{attrs:{to:"/key/"+e.rental.key.id}},[e._v(e._s(e.rental.key.number))])],1)]),a("tr",[a("td",[e._v("Vergeben an")]),a("td",[a("router-link",{attrs:{to:"/user/"+e.rental.user.id}},[e._v(e._s(e.rental.user.name))])],1)]),a("tr",[a("td",[e._v("Ausgegeben von")]),a("td",[a("router-link",{attrs:{to:"/user/"+e.rental.issuing_user.id}},[e._v(e._s(e.rental.issuing_user.name))])],1)]),a("tr",[a("td",[e._v("Dokument")]),a("td",[e._v(e._s(e.rental.allowed_by))])]),a("tr",[a("td",[e._v("Start")]),a("td",[e._v(e._s(new Date(e.rental.begin).toLocaleString("de")))])]),a("tr",[a("td",[e._v("Ende")]),a("td",[e.rental.end?a("span",[e._v(e._s(new Date(e.rental.end).toLocaleString("de")))]):e._e()])]),a("tr",[a("td",[e._v("Aktiv")]),null!=e.rental.active?a("td",{staticClass:"font-weight-bold"},[e.rental.active?a("span",{staticClass:"green--text"},[e._v(" Ja ")]):a("span",{staticClass:"red--text"},[e._v(" Nein ")])]):e._e()]),a("tr",[a("td",[e._v("Notiz")]),a("td",[e._v(e._s(e.rental.note))])])])]},proxy:!0}])}),a("v-divider"),a("div",{staticClass:"buttons"},[a("v-dialog",{attrs:{width:"500px"},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on;return[a("v-btn",e._g({staticClass:"mx-8 my-4",attrs:{color:"secondary"}},n),[a("v-icon",{attrs:{left:"",size:"24"}},[e._v("mdi-delete")]),e._v(" Löschen ")],1)]}}]),model:{value:e.deleteDialog,callback:function(t){e.deleteDialog=t},expression:"deleteDialog"}},[a("v-card",{staticClass:"pb-1"},[a("v-card-title",[e._v("Ausleihe wirklich löschen?")]),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"secondary"},on:{click:e.deleteItem}},[a("v-icon",{attrs:{left:"",size:"24"}},[e._v("mdi-delete")]),e._v(" Bestätigen ")],1)],1)],1)],1),a("form-popup",{ref:"rentalEditPopup",attrs:{form:"edit-rental-form",icon:"mdi-pencil",text:"Bearbeiten"},on:{mounted:function(t){return e.rentalEditFormMountedEvent()},"save-form":function(t){e.loadRental(),e.loadLogs()},"button-add-clicked":function(t){return e.rentalEditFormMountedEvent()}}}),e.rental.active?a("v-dialog",{attrs:{width:"500px"},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on;return[a("v-btn",e._g({staticClass:"mx-8 my-4",attrs:{color:"secondary"}},n),[a("v-icon",{attrs:{left:"",size:"24"}},[e._v("mdi-arrow-u-left-bottom")]),e._v(" Schlüssel Zurückgeben ")],1)]}}],null,!1,4233237325),model:{value:e.returnDialog,callback:function(t){e.returnDialog=t},expression:"returnDialog"}},[a("v-card",{staticClass:"pb-1"},[a("v-card-title",[e._v("Schlüssel wirklich zurückgeben?")]),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"secondary"},on:{click:e.returnItem}},[a("v-icon",{attrs:{left:"",size:"24"}},[e._v("mdi-check")]),e._v(" Speichern ")],1)],1)],1)],1):e._e()],1),a("detail-table-logs",{ref:"logTable",staticClass:"mt-10"})],1)])},Ta=[],Va={name:"DetailRentalView",components:{DetailTableLogs:Zt,FormPopup:T},data(){return{rental:{key:{},user:{},issuing_user:{}},rentalId:void 0,returnDialog:!1,deleteDialog:!1}},mounted(){this.rentalId=this.$route.params.id,this.loadRental(),this.loadLogs()},methods:{loadLogs(){this.$refs.logTable.loadData({rental_id:this.rentalId})},async loadRental(){if(!this.rentalId)return;const e=await R;e.rental_getRental(this.rentalId).then((e=>{this.rental=e.data}))},rentalEditFormMountedEvent(){this.$refs.rentalEditPopup.$refs.form&&this.$refs.rentalEditPopup.$refs.form.fillForm(this.rental)},async returnItem(){const e=await R,t={uuid:this.rental.id};e.rental_endRental(t).then((()=>{this.returnDialog=!1,this.loadRental()}))},async deleteItem(){const e=await R,t={uuid:this.rental.id};e.rental_deleteRental(t).then((()=>{this.$router.push("/rental")}))}},computed:{rentedByUser(){if(!this.rental.active)return!1;let e=N.getUser();return e.id===this.rental.user.id}}},Ca=Va,Ia=(0,m.Z)(Ca,Ea,Ta,!1,null,"4437ed1b",null),La=Ia.exports;D()(Ia,{VAlert:Wt.Z,VBtn:x.Z,VCard:S.Z,VCardActions:w.h7,VCardTitle:w.EB,VDialog:$.Z,VDivider:pe.Z,VIcon:Z.Z,VSimpleTable:Vt.Z,VSpacer:X.Z});var Aa=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"home pb-5"},[a("rental-table",{ref:"rentalTable",staticClass:"mx-7 mt-7",on:{editItem:e.editRental}}),a("form-popup",{ref:"popup",attrs:{text:"Ausleihe bearbeiten",form:"edit-rental-form","hide-btn":""},on:{"save-form":function(t){return e.$refs.rentalTable.loadData()},mounted:e.mountedEvent}})],1)},Ba=[],za=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("DataTable",{ref:"table",attrs:{headers:e.headers,items:e.tableData,"sort-by":"begin","sort-desc":!0},scopedSlots:e._u([{key:"header",fn:function(){return[a("h2",{staticClass:"ml-4"},[e._v("Ausleihen")])]},proxy:!0},{key:"item.link",fn:function(t){var n=t.item;return[a("router-link",{attrs:{to:"/rental/"+n.id}},[a("v-icon",{attrs:{small:""}},[e._v(" mdi-open-in-new ")])],1)]}},{key:"item.begin",fn:function(t){var a=t.item;return[e._v(" "+e._s(new Date(a.begin).toLocaleString("de"))+" ")]}},{key:"item.end",fn:function(t){var n=t.item;return[null!=n.end?a("span",[e._v(" "+e._s(new Date(n.end).toLocaleString("de"))+" ")]):a("span",[e._v(" - ")])]}},{key:"item.key.lock.location",fn:function(t){var n=t.item;return[a("router-link",{attrs:{to:"/location/"+n.key.lock.location.id}},[e._v(e._s(n.key.lock.location.name))])]}},{key:"item.key.lock",fn:function(t){var n=t.item;return[a("router-link",{attrs:{to:"/lock/"+n.key.lock.id}},[e._v(e._s(n.key.lock.name))])]}},{key:"item.key",fn:function(t){var n=t.item;return[a("router-link",{attrs:{to:"/key/"+n.key.id}},[e._v(e._s(n.key.number))])]}},{key:"item.user.name",fn:function(t){var n=t.item;return[a("router-link",{attrs:{to:"/user/"+n.user.id}},[e._v(e._s(n.user.name))])]}},{key:"item.issuing_user.name",fn:function(t){var n=t.item;return[a("router-link",{attrs:{to:"/user/"+n.issuing_user.id}},[e._v(e._s(n.issuing_user.name))])]}},{key:"item.actions",fn:function(t){var n=t.item;return[a("div",{staticClass:"text-right"},[a("v-icon",{staticClass:"mr-2",attrs:{small:""},on:{click:function(t){return e.editItem(n)}}},[e._v(" mdi-pencil ")]),n.active?a("v-tooltip",{attrs:{top:""},scopedSlots:e._u([{key:"activator",fn:function(t){var o=t.on;return[a("v-icon",e._g({staticClass:"mr-2",attrs:{small:""},on:{click:function(t){return e.openReturnPrompt(n)}}},o),[e._v(" mdi-arrow-u-left-bottom ")])]}}],null,!0)},[a("span",[e._v("Schlüssel zurückgeben")])]):e._e()],1)]}}],null,!0)}),a("v-dialog",{attrs:{width:"500px"},model:{value:e.returnDialog,callback:function(t){e.returnDialog=t},expression:"returnDialog"}},[a("v-card",{staticClass:"pb-1"},[a("v-card-title",[e._v("Schlüssel "+e._s(e.rentalInDialog.key.number)+" wirklich zurückgeben?")]),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"secondary"},on:{click:e.returnItem}},[a("v-icon",{attrs:{left:"",size:"24"}},[e._v("mdi-check")]),e._v(" Bestätigen ")],1)],1)],1)],1)],1)},Ra=[],Fa={name:"RentalTable",components:{DataTable:ae},data:()=>({dialog:!1,headers:[{width:"5%",text:"Link",value:"link"},{text:"Ort",value:"key.lock.location"},{text:"Schloss",value:"key.lock"},{text:"Schlüsselnummer",value:"key"},{text:"Ausgeliehen von",value:"user.name"},{text:"Ausgegeben von",value:"issuing_user.name"},{text:"Beginn",value:"begin"},{text:"Ende",value:"end"},{text:"Aktionen",value:"actions",width:"200px",sortable:!1,align:"right"}],tableData:null,rentalInDialog:{key:{}},returnDialog:!1}),mounted(){this.loadData()},methods:{async loadData(){let e=this.$route.params.id;const t=await R;e?t.rental_getRental(e).then((e=>{this.tableData=[e.data]})):t.rental_getRentals().then((e=>{this.tableData=e.data}))},editItem(e){this.$emit("editItem",e)},rentedByUser(e){if(!e.active)return!1;let t=N.getUser();return t.id==e.user.id},openReturnPrompt(e){this.rentalInDialog=e,this.returnDialog=!0},async returnItem(){const e=await R,t={uuid:this.rentalInDialog.id};e.rental_endRental(t).then((()=>{this.returnDialog=!1,this.loadData()}))}}},Ua=Fa,Na=(0,m.Z)(Ua,za,Ra,!1,null,null,null),Ka=Na.exports;D()(Na,{VBtn:x.Z,VCard:S.Z,VCardActions:w.h7,VCardTitle:w.EB,VDialog:$.Z,VIcon:Z.Z,VSpacer:X.Z,VTooltip:ue.Z});var Oa=n.Z.extend({name:"AllRentalsView",components:{FormPopup:T,RentalTable:Ka},data(){return{editedRental:void 0}},methods:{editRental(e){this.editedRental=e,this.$refs.popup.openDialog(),this.$refs.popup.$refs.form&&this.$refs.popup.$refs.form.fillForm(this.editedRental)},mountedEvent(){this.$refs.popup.$refs.form.fillForm(this.editedRental)}}}),Pa=Oa,Ma=(0,m.Z)(Pa,Aa,Ba,!1,null,"2f321788",null),ja=Ma.exports,qa=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"home pb-5"},[a("detail-table-logs",{ref:"logTable",staticClass:"mx-7 mt-7"})],1)},Ga=[],Ja=n.Z.extend({name:"AllLogsView",components:{DetailTableLogs:Zt},data(){return{}},mounted(){this.$refs.logTable.loadData({})}}),Wa=Ja,Ha=(0,m.Z)(Wa,qa,Ga,!1,null,"c3224a78",null),Ya=Ha.exports;n.Z.use(K.Z);const Qa=[{path:"/",name:"start",component:Za,meta:{title:"Start"}},{path:"/key",name:"keyAll",component:_e,meta:{title:"Alle Schlüssel"}},{path:"/key/:id",name:"key",component:ya,meta:{title:"Schlüssel Details"}},{path:"/safe/",name:"safeAll",component:Ve,meta:{title:"Alle Tresore"}},{path:"/safe/:id",name:"safe",component:da,meta:{title:"Tresor Details"}},{path:"/lock",name:"lockAll",component:Oe,meta:{title:"Alle Schlösser"}},{path:"/lock/:id",name:"lock",component:fa,meta:{title:"Schloss Details"}},{path:"/location",name:"locationAll",component:et,meta:{title:"Alle Orte"}},{path:"/location/:id",name:"location",component:Yt,meta:{title:"Ort Details"}},{path:"/user",name:"users",component:mt,meta:{title:"Alle Benutzer"}},{path:"/user/:id",name:"user",component:It,meta:{title:"Benutzer Details"}},{path:"/rental",name:"rentals",component:ja,meta:{title:"Alle Ausleihen"}},{path:"/rental/:id",name:"rental",component:La,meta:{title:"Ausleihe Details"}},{path:"/log",name:"logs",component:Ya,meta:{title:"Alle Logs"}}],Xa=new K.Z({mode:"history",base:"/",routes:Qa});Xa.beforeEach(((e,t,a)=>{const n=e.query.access_token,o=N.getUser();function i(){Xa.push({name:"start",query:{login:"true",return_url:window.location.origin+e.fullPath}})}null!=o?a():null!=n&&"string"===typeof n?N.setAccessToken(n).then((()=>{console.log("Successful login!"),Xa.push({path:e.path,query:{}})})).catch((e=>{console.log(e),i()})):"true"===e.query.login&&"start"==e.name?a():i()}));var en=Xa,tn={name:"AppNavBar",components:{FormPopup:T},data(){return{loggedIn:!1,user:null}},methods:{checkLogin(){this.loggedIn=null!=localStorage.getItem("access_token"),setTimeout((()=>{this.loggedIn=null!=localStorage.getItem("access_token")}),200)},logout(){N.logout(),this.checkLogin(),en.push({name:"start"})}},watch:{loggedIn(){this.user=N.getUser()},$route(e){"true"===e.query.login?this.$refs.loginDialog.openDialog():this.$refs.loginDialog.closeDialog()}},beforeMount(){this.checkLogin(),window.addEventListener("keywi-auth-change",(e=>{this.checkLogin()}))}},an=tn,nn=(0,m.Z)(an,f,p,!1,null,"3723310e",null),on=nn.exports;D()(nn,{VIcon:Z.Z});var sn={name:"AppHeader",components:{AppNavBar:on,AppTitle:v}},rn=sn,ln=(0,m.Z)(rn,s,r,!1,null,"52356c69",null),dn=ln.exports,cn=n.Z.extend({name:"App",components:{AppHeader:dn},data:()=>({}),mounted(){this.$vuetify.theme.currentTheme.secondary="#41A6A0"}}),un=cn,mn=a(7524),hn=a(9846),vn=a(1009),fn=(0,m.Z)(un,o,i,!1,null,null,null),pn=fn.exports;D()(fn,{VApp:mn.Z,VContainer:hn.Z,VMain:vn.Z});var kn=a(9132);n.Z.use(kn.Z);var _n=new kn.Z({icons:{iconfont:"mdi"}}),bn=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-form",{ref:"form"},[a("v-text-field",{attrs:{"prepend-icon":"mdi-text",label:"Name",rules:e.nameRules,required:""},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}}),a("v-text-field",{attrs:{"prepend-icon":"mdi-map-marker",label:"Adresse"},model:{value:e.address,callback:function(t){e.address=t},expression:"address"}}),a("v-text-field",{attrs:{"prepend-icon":"mdi-latitude",label:"Breitengrad (latitude)"},model:{value:e.lat,callback:function(t){e.lat=t},expression:"lat"}}),a("v-text-field",{attrs:{"prepend-icon":"mdi-longitude",label:"Längengrad (longitude)"},model:{value:e.lon,callback:function(t){e.lon=t},expression:"lon"}}),a("v-textarea",{attrs:{"prepend-icon":"mdi-note-text-outline",rows:"1",label:"Notiz"},model:{value:e.note,callback:function(t){e.note=t},expression:"note"}}),a("v-btn",{attrs:{color:"validate"},on:{click:e.save}},[a("v-icon",{attrs:{left:"",size:"24"}},[e._v("mdi-content-save-outline")]),e._v(" Speichern ")],1)],1)},gn=[],yn={name:"AddLocationForm",data(){return{name:"",address:"",lat:void 0,lon:void 0,locationId:void 0,note:"",nameRules:[e=>!!e||"Name erforderlich"]}},mounted(){this.$emit("mounted")},methods:{fillForm(e){e?(this.name=e.name,this.address=e.address,this.lat=e.latitude,this.lon=e.longitude,this.locationId=e.id,this.note=e.note):(this.name="",this.address="",this.lat=void 0,this.lon=void 0,this.locationId=void 0,this.note=""),this.$refs.form.resetValidation()},async save(){if(this.$refs.form.validate()){const e=await R;let t={name:this.name,address:this.address,latitude:this.lat,longitude:this.log,note:this.note};if(this.locationId){const a={uuid:this.locationId};e.location_editLocation(a,t).then((()=>{this.$refs.form.reset(),this.$emit("save-form")}))}else e.location_createLocation(null,t).then((()=>{this.$refs.form.reset(),this.$emit("save-form")}))}}}},Dn=yn,xn=(0,m.Z)(Dn,bn,gn,!1,null,"2df472e0",null),Sn=xn.exports;D()(xn,{VBtn:x.Z,VForm:le.Z,VIcon:Z.Z,VTextField:ee.Z,VTextarea:ce.Z});var wn=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-form",{ref:"form"},[a("v-autocomplete",{attrs:{"prepend-icon":"mdi-lock",items:e.locks,label:"Schloss","item-text":function(t){return e.getDisplayName(t)},"item-value":function(e){return e.id},rules:e.lockRule,"return-object":""},model:{value:e.selectedLock,callback:function(t){e.selectedLock=t},expression:"selectedLock"}}),a("v-text-field",{attrs:{"prepend-icon":"mdi-key",label:"Schlüsselnummer",rules:e.numberRules,required:""},model:{value:e.number,callback:function(t){e.number=t},expression:"number"}}),a("v-autocomplete",{attrs:{"prepend-icon":"mdi-safe-square-outline",items:e.safes,label:"Tresor","item-text":function(t){return e.getDisplayName(t)},"item-value":function(e){return e.id},rules:e.safeRule,"return-object":""},model:{value:e.selectedSafe,callback:function(t){e.selectedSafe=t},expression:"selectedSafe"}}),a("v-checkbox",{attrs:{label:"Ausleihbar"},model:{value:e.rentable,callback:function(t){e.rentable=t},expression:"rentable"}}),a("v-textarea",{attrs:{"prepend-icon":"mdi-note-text-outline",rows:"1",label:"Notiz"},model:{value:e.note,callback:function(t){e.note=t},expression:"note"}}),a("v-btn",{attrs:{color:"validate"},on:{click:e.save}},[a("v-icon",{attrs:{left:"",size:"24"}},[e._v("mdi-content-save-outline")]),e._v(" Speichern ")],1)],1)},$n=[],Zn={name:"EditKeyForm",data(){return{number:"",locks:[],safes:[],selectedLock:void 0,selectedSafe:void 0,rentable:!0,note:"",keyId:void 0,numberRules:[e=>!!e||"Schlüsselnummer erforderlich"],lockRule:[e=>!!e||"Bitte Schloss auswählen"],safeRule:[e=>!!e||"Bitte Tresor auswählen"]}},mounted(){this.loadData(),this.$emit("mounted")},methods:{fillForm(e){e?(this.keyId=e.id,this.number=e.number,this.rentable=e.rentable,this.selectedSafe=e.safe,this.selectedLock=e.lock,this.note=e.note):(this.keyId=void 0,this.number="",this.rentable=!0,this.selectedSafe=void 0,this.selectedLock=void 0,this.note=""),this.$refs.form.resetValidation()},getDisplayName(e){return e.location?e.name+" ("+e.location.name+")":e.name},async save(){if(this.$refs.form.validate()&&this.selectedLock&&this.selectedSafe){const e=await R;let t={number:this.number,lock_id:this.selectedLock.id,safe_id:this.selectedSafe.id,rentable:this.rentable,note:this.note};if(this.keyId){const a={uuid:this.keyId};e.key_editKey(a,t).then((()=>{this.$refs.form.reset(),this.$emit("save-form")}))}else e.key_createKey(null,t).then((e=>{this.$refs.form.reset(),this.keyId=e.data.id,this.$emit("save-form")}))}},async loadData(){const e=await R;e.lock_getLocks().then((e=>{this.locks=e.data})).then(e.safe_getSafes).then((e=>{this.safes=e.data}))}}},En=Zn,Tn=(0,m.Z)(En,wn,$n,!1,null,"3797cf22",null),Vn=Tn.exports;D()(Tn,{VAutocomplete:ie.Z,VBtn:x.Z,VCheckbox:se.Z,VForm:le.Z,VIcon:Z.Z,VTextField:ee.Z,VTextarea:ce.Z});var Cn=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-form",{ref:"form"},[a("v-text-field",{attrs:{"prepend-icon":"mdi-lock",label:"Name",rules:e.nameRules,required:""},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}}),a("v-text-field",{attrs:{"prepend-icon":"mdi-account",label:"Besitzer"},model:{value:e.owner,callback:function(t){e.owner=t},expression:"owner"}}),a("v-autocomplete",{attrs:{"prepend-icon":"mdi-map-marker",items:e.locations,label:"Ort","item-text":"name","item-value":"id",rules:e.selectRule,"return-object":""},model:{value:e.selectedLocation,callback:function(t){e.selectedLocation=t},expression:"selectedLocation"}}),a("v-textarea",{attrs:{"prepend-icon":"mdi-note-text-outline",rows:"1",label:"Notiz"},model:{value:e.note,callback:function(t){e.note=t},expression:"note"}}),a("v-btn",{attrs:{color:"validate"},on:{click:e.save}},[a("v-icon",{attrs:{left:"",size:"24"}},[e._v("mdi-content-save-outline")]),e._v(" Speichern ")],1)],1)},In=[],Ln={name:"EditLockForm",data(){return{name:"",owner:void 0,locations:[],selectedLocation:void 0,note:"",nameRules:[e=>!!e||"Name erforderlich"],selectRule:[e=>!!e||"Bitte Ort auswählen"]}},mounted(){this.loadLocations(),this.$emit("mounted")},methods:{fillForm(e){e?(this.lockId=e.id,this.name=e.name,this.owner=e.owner,this.selectedLocation=e.location,this.note=e.note):(this.lockId=void 0,this.name="",this.owner="",this.selectedLocation=void 0,this.note=""),this.$refs.form.resetValidation()},async save(){if(this.$refs.form.validate()&&this.selectedLocation){const e=await R,t={name:this.name,owner:this.owner,location_id:this.selectedLocation.id,note:this.note};if(this.lockId){const a={uuid:this.lockId};e.lock_editLock(a,t).then((()=>{this.$refs.form.reset(),this.$emit("save-form")}))}else e.lock_createLock(null,t).then((()=>{this.$refs.form.reset(),this.$emit("save-form")}))}},async loadLocations(){const e=await R;e.location_getLocations().then((e=>{this.locations=e.data}))}}},An=Ln,Bn=(0,m.Z)(An,Cn,In,!1,null,"b0b4f478",null),zn=Bn.exports;D()(Bn,{VAutocomplete:ie.Z,VBtn:x.Z,VForm:le.Z,VIcon:Z.Z,VTextField:ee.Z,VTextarea:ce.Z});var Rn=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-form",{ref:"form"},[a("v-text-field",{attrs:{"prepend-icon":"mdi-safe-square-outline",label:"Name",rules:e.nameRules,required:""},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}}),a("v-autocomplete",{attrs:{"prepend-icon":"mdi-map-marker",items:e.locations,label:"Ort","item-text":"name","item-value":"id",rules:e.selectRule,"return-object":""},model:{value:e.selectedLocation,callback:function(t){e.selectedLocation=t},expression:"selectedLocation"}}),a("v-textarea",{attrs:{"prepend-icon":"mdi-note-text-outline",rows:"1",label:"Notiz"},model:{value:e.note,callback:function(t){e.note=t},expression:"note"}}),a("v-btn",{attrs:{color:"validate"},on:{click:e.save}},[a("v-icon",{attrs:{left:"",size:"24"}},[e._v("mdi-content-save-outline")]),e._v(" Speichern ")],1)],1)},Fn=[],Un={name:"EditSafeForm",data(){return{safeId:null,name:"",locations:[],selectedLocation:void 0,note:"",nameRules:[e=>!!e||"Name erforderlich"],selectRule:[e=>!!e||"Bitte Ort auswählen"]}},mounted(){this.loadLocations(),this.$emit("mounted")},methods:{fillForm(e){e?(this.safeId=e.id,this.name=e.name,this.selectedLocation=e.location,this.note=e.note):(this.safeId=void 0,this.name="",this.selectedLocation=void 0,this.note=""),this.$refs.form.resetValidation()},async save(){if(this.$refs.form.validate()&&this.selectedLocation){const e=await R,t={name:this.name,location_id:this.selectedLocation.id,note:this.note};if(this.safeId){const a={uuid:this.safeId};e.safe_editSafe(a,t).then((()=>{this.$refs.form.reset(),this.$emit("save-form")}))}else e.safe_createSafe(null,t).then((()=>{this.$refs.form.reset(),this.$emit("save-form")}))}},async loadLocations(){const e=await R;e.location_getLocations().then((e=>{this.locations=e.data}))}}},Nn=Un,Kn=(0,m.Z)(Nn,Rn,Fn,!1,null,"6f218437",null),On=Kn.exports;D()(Kn,{VAutocomplete:ie.Z,VBtn:x.Z,VForm:le.Z,VIcon:Z.Z,VTextField:ee.Z,VTextarea:ce.Z});var Pn=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.error?a("v-alert",{attrs:{color:"red",type:"error"}},[e._v(" Nutzername oder Passwort falsch! ")]):e._e(),a("v-row",[a("v-col",{staticClass:"text-center"},[a("v-btn",{attrs:{block:"",color:"primary"},on:{click:e.loginWithOAuth}},[a("v-icon",{attrs:{left:""}},[e._v("mdi-key")]),e._v(" Mit AG DSN Konto anmelden ")],1)],1)],1),a("v-row",[a("v-col",[a("v-divider")],1)],1),a("v-row",[a("v-col",[a("v-form",{ref:"form"},[a("v-text-field",{attrs:{rules:e.nameRules,label:"Nutzername","prepend-icon":"mdi-account",required:""},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),a("v-text-field",{attrs:{rules:e.passwordRules,label:"Passwort","prepend-icon":"mdi-key",required:"",type:"password"},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.login.apply(null,arguments)}},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),a("v-row",[a("v-spacer"),a("v-btn",{staticClass:"mt-3",attrs:{color:"secondary"},on:{click:e.login}},[e._v(" Login ")])],1)],1)],1)],1)],1)},Mn=[],jn={name:"LoginForm",data(){return{username:null,password:null,error:!1,nameRules:[e=>!!e||"Bitte Nutzernamen eingeben"],passwordRules:[e=>!!e||"Bitte Password eingeben"]}},methods:{async login(){if(this.$refs.form.validate())try{await N.login(this.username,this.password),this.$refs.form.reset(),this.$emit("save-form"),this.$emit("submit")}catch(e){this.error=!0}},async loginWithOAuth(){window.location.href=N.getOAuthUrl(this.$route.query.return_url)}}},qn=jn,Gn=(0,m.Z)(qn,Pn,Mn,!1,null,"1967bf2a",null),Jn=Gn.exports;D()(Gn,{VAlert:Wt.Z,VBtn:x.Z,VCol:H.Z,VDivider:pe.Z,VForm:le.Z,VIcon:Z.Z,VRow:Q.Z,VSpacer:X.Z,VTextField:ee.Z});var Wn=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-form",{ref:"form"},[a("v-autocomplete",{attrs:{"item-text":function(e){return e.name+" ("+e.email+")"},"return-object":"",items:e.users,label:"Vergeben an","prepend-icon":"mdi-account",rules:e.userRules},model:{value:e.pickedUser,callback:function(t){e.pickedUser=t},expression:"pickedUser"}}),a("v-text-field",{attrs:{"prepend-icon":"mdi-file-document",label:"Dokument"},model:{value:e.grantingDocument,callback:function(t){e.grantingDocument=t},expression:"grantingDocument"}}),a("v-textarea",{attrs:{"prepend-icon":"mdi-note-text-outline",rows:"1",label:"Notiz"},model:{value:e.note,callback:function(t){e.note=t},expression:"note"}}),a("v-checkbox",{attrs:{label:"Startdatum bearbeiten"},model:{value:e.editStartDate,callback:function(t){e.editStartDate=t},expression:"editStartDate"}}),a("v-menu",{attrs:{"close-on-content-click":!1,"nudge-right":40,transition:"scale-transition","offset-y":"","min-width":"auto"},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on,o=t.attrs;return[a("v-text-field",e._g(e._b({staticStyle:{"margin-top":"-10px"},attrs:{disabled:!e.editStartDate,label:"Startdatum","prepend-icon":"mdi-calendar",readonly:""},model:{value:e.dateStart,callback:function(t){e.dateStart=t},expression:"dateStart"}},"v-text-field",o,!1),n))]}}]),model:{value:e.menuStartDate,callback:function(t){e.menuStartDate=t},expression:"menuStartDate"}},[a("v-date-picker",{on:{input:function(t){e.menuStartDate=!1}},model:{value:e.dateStart,callback:function(t){e.dateStart=t},expression:"dateStart"}})],1),a("v-checkbox",{attrs:{label:"Enddatum bearbeiten"},model:{value:e.editEndDate,callback:function(t){e.editEndDate=t},expression:"editEndDate"}}),a("v-menu",{attrs:{"close-on-content-click":!1,"nudge-right":40,transition:"scale-transition","offset-y":"","min-width":"auto"},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on,o=t.attrs;return[a("v-text-field",e._g(e._b({staticStyle:{"margin-top":"-10px"},attrs:{disabled:!e.editEndDate,label:"Enddatum","prepend-icon":"mdi-calendar",readonly:""},model:{value:e.dateEnd,callback:function(t){e.dateEnd=t},expression:"dateEnd"}},"v-text-field",o,!1),n))]}}]),model:{value:e.menuEndDate,callback:function(t){e.menuEndDate=t},expression:"menuEndDate"}},[a("v-date-picker",{on:{input:function(t){e.menuEndDate=!1}},model:{value:e.dateEnd,callback:function(t){e.dateEnd=t},expression:"dateEnd"}})],1),a("v-btn",{attrs:{color:"secondary"},on:{click:e.save}},[a("v-icon",{attrs:{left:"",size:"24"}},[e._v("mdi-content-save-outline")]),e._v(" Speichern ")],1)],1)},Hn=[],Yn={name:"RentKeyForm",data(){return{users:[],pickedUser:void 0,grantingDocument:"",note:"",menuStartDate:!1,editStartDate:!1,dateStart:void 0,menuEndDate:!1,editEndDate:!1,dateEnd:void 0,userRules:[e=>!!e||"Bitte Nutzer auswählen"],keyId:void 0}},mounted(){this.loadUsers(),this.$emit("mounted")},methods:{setKeyId(e){this.keyId=e,this.$refs.form.resetValidation()},async loadUsers(){const e=await R;e.user_getUsers().then((e=>{this.users=e.data}))},dateToDatetime(e){return e+"T12:37"},async save(){if(this.$refs.form.validate()){const e=await R,t={key_id:this.keyId,user_id:this.pickedUser.id,allowed_by:this.grantingDocument,note:this.note};this.editStartDate&&this.dateStart&&(t.begin=this.dateToDatetime(this.dateStart)),this.editEndDate&&this.dateEnd&&(t.end=this.dateToDatetime(this.dateEnd)),e.rental_createRental(null,t).then((()=>{this.$emit("save-form")}))}}}},Qn=Yn,Xn=(0,m.Z)(Qn,Wn,Hn,!1,null,"7bb49895",null),eo=Xn.exports;D()(Xn,{VAutocomplete:ie.Z,VBtn:x.Z,VCheckbox:se.Z,VDatePicker:re.Z,VForm:le.Z,VIcon:Z.Z,VMenu:de.Z,VTextField:ee.Z,VTextarea:ce.Z});var to=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-form",{ref:"form"},[a("v-text-field",{attrs:{label:"Dokument","prepend-icon":"mdi-file-document"},model:{value:e.grantingDocument,callback:function(t){e.grantingDocument=t},expression:"grantingDocument"}}),a("v-textarea",{attrs:{label:"Notiz","prepend-icon":"mdi-note-text-outline",rows:"1"},model:{value:e.note,callback:function(t){e.note=t},expression:"note"}}),a("v-checkbox",{attrs:{label:"Startdatum bearbeiten"},model:{value:e.editStartDate,callback:function(t){e.editStartDate=t},expression:"editStartDate"}}),a("v-menu",{attrs:{"close-on-content-click":!1,"nudge-right":40,transition:"scale-transition","offset-y":"","min-width":"auto"},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on,o=t.attrs;return[a("v-text-field",e._g(e._b({staticStyle:{"margin-top":"-10px"},attrs:{disabled:!e.editStartDate,label:"Startdatum","prepend-icon":"mdi-calendar",readonly:""},model:{value:e.dateStart,callback:function(t){e.dateStart=t},expression:"dateStart"}},"v-text-field",o,!1),n))]}}]),model:{value:e.menuStartDate,callback:function(t){e.menuStartDate=t},expression:"menuStartDate"}},[a("v-date-picker",{on:{input:function(t){e.menuStartDate=!1}},model:{value:e.dateStart,callback:function(t){e.dateStart=t},expression:"dateStart"}})],1),a("v-checkbox",{attrs:{label:"Enddatum bearbeiten"},model:{value:e.editEndDate,callback:function(t){e.editEndDate=t},expression:"editEndDate"}}),a("v-menu",{attrs:{"close-on-content-click":!1,"nudge-right":40,transition:"scale-transition","offset-y":"","min-width":"auto"},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on,o=t.attrs;return[a("v-text-field",e._g(e._b({staticStyle:{"margin-top":"-10px"},attrs:{disabled:!e.editEndDate,label:"Enddatum","prepend-icon":"mdi-calendar",readonly:""},model:{value:e.dateEnd,callback:function(t){e.dateEnd=t},expression:"dateEnd"}},"v-text-field",o,!1),n))]}}]),model:{value:e.menuEndDate,callback:function(t){e.menuEndDate=t},expression:"menuEndDate"}},[a("v-date-picker",{on:{input:function(t){e.menuEndDate=!1}},model:{value:e.dateEnd,callback:function(t){e.dateEnd=t},expression:"dateEnd"}})],1),a("v-btn",{attrs:{color:"validate"},on:{click:e.save}},[a("v-icon",{attrs:{left:"",size:"24"}},[e._v("mdi-content-save-outline")]),e._v(" Speichern ")],1)],1)},ao=[],no={name:"EditRentalForm",data(){return{rentalId:void 0,grantingDocument:"",note:"",menuStartDate:!1,editStartDate:!1,dateStart:void 0,menuEndDate:!1,editEndDate:!1,dateEnd:void 0}},mounted(){this.$emit("mounted")},methods:{fillForm(e){this.editStartDate=!1,this.editEndDate=!1,e?(this.rentalId=e.id,this.grantingDocument=e.allowed_by,this.note=e.note,e.begin&&(this.dateStart=this.datetimeToDate(e.begin)),e.end&&(this.dateEnd=this.datetimeToDate(e.end))):(this.rentalId=void 0,this.grantingDocument="",this.note=""),this.$refs.form.resetValidation()},dateToDatetime(e){return e+"T12:37"},datetimeToDate(e){return e.substring(0,e.indexOf("T"))},async save(){const e=await R;let t={allowed_by:this.grantingDocument,note:this.note};if(this.editStartDate&&this.dateStart&&(t.begin=this.dateToDatetime(this.dateStart)),this.editEndDate&&this.dateEnd&&(t.end=this.dateToDatetime(this.dateEnd)),this.rentalId){const a={uuid:this.rentalId};e.rental_editRental(a,t).then((()=>{this.$refs.form.reset(),this.$emit("save-form")}))}else e.rental_createRental(null,t).then((()=>{this.$refs.form.reset(),this.$emit("save-form")}))}}},oo=no,io=(0,m.Z)(oo,to,ao,!1,null,"706ed13d",null),so=io.exports;D()(io,{VBtn:x.Z,VCheckbox:se.Z,VDatePicker:re.Z,VForm:le.Z,VIcon:Z.Z,VMenu:de.Z,VTextField:ee.Z,VTextarea:ce.Z}),n.Z.config.productionTip=!1,n.Z.component("edit-location-form",Sn),n.Z.component("edit-key-form",Vn),n.Z.component("edit-lock-form",zn),n.Z.component("edit-safe-form",On),n.Z.component("edit-rental-form",so),n.Z.component("login-form",Jn),n.Z.component("rent-key-form",eo),new n.Z({router:en,vuetify:_n,render:e=>e(pn)}).$mount("#app")},3471:function(){},6854:function(){},4616:function(){}},t={};function a(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(i.exports,i,i.exports,a),i.loaded=!0,i.exports}a.m=e,function(){var e=[];a.O=function(t,n,o,i){if(!n){var s=1/0;for(c=0;c<e.length;c++){n=e[c][0],o=e[c][1],i=e[c][2];for(var r=!0,l=0;l<n.length;l++)(!1&i||s>=i)&&Object.keys(a.O).every((function(e){return a.O[e](n[l])}))?n.splice(l--,1):(r=!1,i<s&&(s=i));if(r){e.splice(c--,1);var d=o();void 0!==d&&(t=d)}}return t}i=i||0;for(var c=e.length;c>0&&e[c-1][2]>i;c--)e[c]=e[c-1];e[c]=[n,o,i]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.hmd=function(e){return e=Object.create(e),e.children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:function(){throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e}}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){a.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={143:0};a.O.j=function(t){return 0===e[t]};var t=function(t,n){var o,i,s=n[0],r=n[1],l=n[2],d=0;if(s.some((function(t){return 0!==e[t]}))){for(o in r)a.o(r,o)&&(a.m[o]=r[o]);if(l)var c=l(a)}for(t&&t(n);d<s.length;d++)i=s[d],a.o(e,i)&&e[i]&&e[i][0](),e[s[d]]=0;return a.O(c)},n=self["webpackChunkkeywi"]=self["webpackChunkkeywi"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=a.O(void 0,[998],(function(){return a(773)}));n=a.O(n)})();
//# sourceMappingURL=app.d1b2f086.js.map